
                 AVR を使用した発振器.
                 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

■ 概要

  これは、ATtiny2313を使用した、発振器です。


■ 動作説明

  内蔵8MHzで動作し、1MHz程度の発振出力をPB0に出します。
  PD5がGND接続の場合は、周波数が250kHzになります。

  FuseをXtalに設定して、クロックを8MHzにすれば正確な出力になります。

■ ビルド環境

-	コンパイラはavr-gcc 4.3.3 を使用しました。
-	4.x系のAVR-gccは、極力関数インライン展開することでパフォーマンスを得ています。
	が、tiny2313では、メモリーオーバーするので -finline-limit=1 オプションを与えて回避します。


■ 配線図

                  ATtiny2313
                  ___    ___
RESET            [1  |__| 20] Vcc
PD0(RxD)         [2       19] PB7(SCK)
PD1(TxD)         [3       18] PB6(MISO)
XTAL2            [4       17] PB5(MOSI)
XTAL1            [5       16] PB4              
PD2              [6       15] PB3
PD3              [7       14] PB2
PD4              [8       13] PB1           
PD5              [9       12] PB0           
GND              [10      11] PD6           
                  ~~~~~~~~~~~               

   ---------------------------------------
   XTAL:    XTAL1,2 => Crystal 3.579545MHz
   PB3:     動作確認用LED ( LEDの片方は1kΩを経由して+5V)
   PB2:     電源制御用Tr  ( アラーム時刻に１秒 OnになるTr)
   PD0(RxD) USART --- USB経由などでPCに繋ぐ
   PD1(TxD) USART --- USB経由などでPCに繋ぐ
   RESET:   10kΩ程度で5V Pullupする.
   Vcc:     5V
   GND:     GND
   ---------------------------------------



■ FUSE設定

ヒューズの設定例は、以下のように設定します。

Low: 11100100
     ||||++++-- CKSEL[3:0] システムクロック選択
     ||++-- SUT[1:0] 起動時間
     |+-- CKOUT (0:PD2にシステムクロックを出力)
     +-- CKDIV8 クロック分周初期値 (1:1/1, 0:1/8)

High:11-11011
     |||||||+-- RSTDISBL (RESETピン 1:有効, 0:無効(PA2))
     ||||+++-- BODLEVEL[2:0] (111:Off, 110:1.8, 101:2.7, 100:4.3)
     |||+-- WDTON (WDT 0:常時ON, 1:通常)
     ||+-- SPIEN (1:ISP禁止, 0:ISP許可) ※Parallel時のみ
     |+-- EESAVE (消去でEEPROMを 1:消去, 0:保持)
     +-- DWEN (On-Chipデバッグ 1:無効, 0:有効)

Ext: -------1
            +-- SPMEN (SPM命令 1:無効, 0:有効)

Cal: 93 89
