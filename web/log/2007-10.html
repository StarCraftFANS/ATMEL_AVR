<?xml version="1.0" encoding="EUC-JP" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja">

<head>
 <meta http-equiv="content-type" content="application/xhtml+xml; charset=EUC-JP" />
 <title>2007-10 - AVR etc</title>

<!-- ヒント:六四天安門事件 -->
<!-- Free Tibet!  -->
<!-- About Tiananmen Massacre -->
<!-- Free Tibet!  -->
<!-- ヒント:六四天安門事件 -->
<!-- About Tiananmen Massacre -->

 <link rel="stylesheet" type="text/css" media="screen" href="../skin/monobook/monobook.css" />
 <link rel="stylesheet" type="text/css" media="print" href="../skin/monobook/monobook.print.css" />
 <link rel="alternate" type="application/rss+xml" title="RSS" href="FrontPage.html?cmd=rss" />
</head>
<body>
<div id="globalWrapper">
 <div id="menubar"><ul><li><a href="FrontPage.html" title="FrontPage (9m)">Ｔｏｐ</a></li></ul>
<hr class="full_hr" />
<p><a href="A3C8A3C9A3C4A3E1A3F3A3F0A3F8.html" title="ＨＩＤａｓｐｘ (9m)">ＨＩＤａｓｐｘ</a></p>
<ul><li><a href="A3C4A3EFA3F7A3EEA3CCA3EFA3E1A3E4.html" title="ＤｏｗｎＬｏａｄ (48d)">ＤｏｗｎＬｏａｄ</a></li>
<li><a href="A3C8A3C9A3C4A3E1A3F3A3F0B9E2C2AEB2BD.html" title="ＨＩＤａｓｐ高速化 (730d)">ＨＩＤａｓｐ高速化</a></li></ul>
<p><a href="C0A9BAEE.html" title="制作 (10m)">制作</a></p>
<p><a href="AVRetc.html" title="AVRetc (22d)">ＡＶＲ関係</a></p>
<ul><li><a href="AVR_Monit.html" title="AVR_Monit (268d)">AVR_Monit</a></li>
<li><a href="AVR_term.html" title="AVR_term (276d)">AVR_term</a></li>
<li><a href="W32_term.html" title="W32_term (783d)">W32_term</a></li>
<li><a href="HIDmon88.html" title="HIDmon88 (668d)">HIDmon88</a></li>
<li><a href="HIDtester.html" title="HIDtester (564d)">HIDtester</a></li>
<li><a href="usbRS232.html" title="usbRS232 (380d)">usbRS232</a></li>
<li><a href="Arduino2313.html" title="Arduino2313 (358d)">Arduino2313</a></li>
<li><a href="A5C7A5B8A5BFA5EBA5C6A5B9A5BFA1BC.html" title="デジタルテスター (573d)">デジタルテスター</a></li>
<li><a href="ATmega88C0B8B3E8.html" title="ATmega88生活 (169d)">ATmega88生活</a></li>
<li><a href="KeyBoardA5DEA5CBA5A2.html" title="KeyBoardマニア (611d)">KeyBoardマニア</a></li>
<li><a href="KeyBoardA5DEA5CBA5A2II.html" title="KeyBoardマニアII (487d)">KeyBoardマニアII</a></li>
<li><a href="Arduino400.html" title="Arduino400 (165d)">Arduino400</a></li>
<li><a href="PICspx.html" title="PICspx (197d)">PICライター</a></li>
<li><a href="hid_blaster.html" title="hid_blaster (8m)">ARMライター</a></li></ul>
<p><a href="ARM.html" title="ARM (16d)">ARM</a></p>
<ul><li><a href="armon.html" title="armon (8d)">STM32ブートローダー</a></li>
<li><a href="stm32f103.html" title="stm32f103 (26d)">STM8S-Discovery改造</a></li>
<li><a href="LPCXpresso.html" title="LPCXpresso (32d)">LPCXpresso</a></li>
<li><a href="lpc-armon.html" title="lpc-armon (8d)">LPC用ブートローダー</a></li>
<li><a href="LPCUSB.html" title="LPCUSB (32d)">NXP用LPCUSB</a></li>
<li><a href="ARM7mon.html" title="ARM7mon (8d)">NXP用ブートローダー</a></li></ul>
<p>PIC18F</p>
<ul><li><a href="pic18boot.html" title="pic18boot (185d)">HIDブートローダー</a></li>
<li><a href="pic18spx.html" title="pic18spx (6d)">AVR/PIC両用ライター</a></li>
<li><a href="pic18blaster.html" title="pic18blaster (2m)">ARMライター</a></li>
<li><a href="usbserial.html" title="usbserial (52d)">usbシリアル変換</a></li>
<li><a href="pic18hidkey.html" title="pic18hidkey (219d)">usbキーボード変換</a></li>
<li><a href="sdcc.html" title="sdcc (380d)">sdccを使いこなす</a></li>
<li><a href="mcc18.html" title="mcc18 (370d)">mcc18を使いこなす</a></li>
<li><a href="HIDmon-2550.html" title="HIDmon-2550 (185d)">HIDmon-2550</a></li>
<li><a href="HIDmon-14K50.html" title="HIDmon-14K50 (185d)">HIDmon-14K50</a></li>
<li><a href="PICmonitor.html" title="PICmonitor (176d)">PICmonitor</a></li></ul>
<p>試行錯誤の記録</p>
<ul><li><a href="UBW.html" title="UBW (541d)">UBWを試す</a></li>
<li><a href="HIDboot.html" title="HIDboot (521d)">旧HIDboot</a></li>
<li><a href="PIC18F2550.html" title="PIC18F2550 (235d)">PIC18F2550試用記</a></li>
<li><a href="PIC18F4550.html" title="PIC18F4550 (522d)">PIC18F4550試用記</a></li></ul>
<p>その他マイコン</p>
<ul><li><a href="NEC78K.html" title="NEC78K (265d)">NEC78K</a></li>
<li><a href="A3C8A3B8.html" title="Ｈ８ (165d)">Ｈ８</a></li>
<li><a href="Android.html" title="Android (9d)">Android</a></li></ul>
<p>開発日記</p>
<ul><li><a href="2010-10.html" title="2010-10 (24m)">2010-10</a></li></ul>
<hr class="full_hr" />
<p>ノウハウ</p>
<ul><li><a href="AVRUSB_Tips.html" title="AVRUSB_Tips (775d)">AVRUSB_Tips</a></li>
<li><a href="A3C8A3C9A3C4A3E1A3F3A3F0BEF0CAF3.html" title="ＨＩＤａｓｐ情報 (395d)">ＨＩＤａｓｐ情報</a></li>
<li><a href="C8C6CDD1A3D5A3D3A3C2-A3C9A3CF.html" title="汎用ＵＳＢ-ＩＯ (727d)">汎用ＵＳＢ-ＩＯ</a></li></ul>
<hr class="full_hr" />
<p>・<a href="AVRlink.html" title="AVRlink (726d)">リンク</a></p>
<p>フリースペース</p>
<ul><li><a href="http://psp.dip.jp/web/cgi-bin/note/index.cgi" rel="nofollow">ゲストブック</a></li></ul>
<hr class="full_hr" />
<p><a href="A3D7A3E9A3E4A3E5A3D4A3E5A3F8A3F4.html" title="ＷｉｄｅＴｅｘｔ (170d)">旧コンテンツ</a><br />
<a href="A3D7A3E9A3EEA3D6A3E9A3F3A3F4A3E1.html" title="ＷｉｎＶｉｓｔａ (876d)">ＷｉｎＶｉｓｔａ</a><br />
<a href="A5A4A5F3A5BFA1BCA5D5A5A7A1BCA5B9B9CD.html" title="インターフェース考 (1138d)">インターフェース考</a></p>
<hr class="full_hr" />
<h5>最新の20件</h5>
<div><strong>2010-10-10</strong>
<ul>
 <li><a href="pic18blaster.html" title="pic18blaster (2m)">pic18blaster</a></li>
 <li><a href="hid_blaster.html" title="hid_blaster (8m)">hid_blaster</a></li>
 <li><a href="A3C8A3C9A3C4A3E1A3F3A3F0A3F8.html" title="ＨＩＤａｓｐｘ (9m)">ＨＩＤａｓｐｘ</a></li>
 <li><a href="FrontPage.html" title="FrontPage (9m)">FrontPage</a></li>
 <li><a href="C0A9BAEE.html" title="制作 (10m)">制作</a></li>
 <li><a href="MenuBar.html" title="MenuBar (11m)">MenuBar</a></li>
 <li><a href="2010-10.html" title="2010-10 (24m)">2010-10</a></li>
</ul>
<strong>2010-10-08</strong>
<ul>
 <li><a href="RecentDeleted.html" title="RecentDeleted (1d)">RecentDeleted</a></li>
</ul>
<strong>2010-10-04</strong>
<ul>
 <li><a href="pic18spx.html" title="pic18spx (6d)">pic18spx</a></li>
</ul>
<strong>2010-10-01</strong>
<ul>
 <li><a href="armon.html" title="armon (8d)">armon</a></li>
 <li><a href="lpc-armon.html" title="lpc-armon (8d)">lpc-armon</a></li>
 <li><a href="ARM7mon.html" title="ARM7mon (8d)">ARM7mon</a></li>
 <li><a href="Android.html" title="Android (9d)">Android</a></li>
</ul>
<strong>2010-09-29</strong>
<ul>
 <li><a href="2010-09.html" title="2010-09 (11d)">2010-09</a></li>
</ul>
<strong>2010-09-23</strong>
<ul>
 <li><a href="ARM.html" title="ARM (16d)">ARM</a></li>
</ul>
<strong>2010-09-18</strong>
<ul>
 <li><a href="AVRetc.html" title="AVRetc (22d)">AVRetc</a></li>
</ul>
<strong>2010-09-14</strong>
<ul>
 <li><a href="stm32f103.html" title="stm32f103 (26d)">stm32f103</a></li>
</ul>
<strong>2010-09-08</strong>
<ul>
 <li><a href="LPCUSB.html" title="LPCUSB (32d)">LPCUSB</a></li>
 <li><a href="LPCXpresso.html" title="LPCXpresso (32d)">LPCXpresso</a></li>
</ul>
<strong>2010-09-05</strong>
<ul>
 <li><a href="SiteMap.html" title="SiteMap (35d)">SiteMap</a></li>
</ul>
</div>
</div>
 <div id="mainColumnWrapper">
  <div id="main-column">
   <div id="navigator"><ul><li id="wn_main" class="selected"><a href="" title="2007-10 (1074d)">本文</a></li><li id="wn_note"><span class="noexists">ノート<a href="FrontPage.html?cmd=edit&amp;page=note%2F2007-10">?</a></span></li><li><a href="FrontPage.html?cmd=edit&amp;page=2007-10">編集</a></li><li><a href="FrontPage.html?cmd=diff&amp;page=2007-10">差分</a></li></ul></div>
   <div id="content">
    <h1 class="firstHeading">2007-10</h1><div id="contentSub"></div>
    <p><a href="2007-09.html" title="2007-09 (775d)">2007-09</a></p>
<hr class="full_hr" />
<h4 id="content_1_0">もう１０月  <a class="anchor_super" id="j13e9237" href="#j13e9237" title="j13e9237"> </a></h4>
<ul class="list1" style="padding-left:16px;margin-left:16px"><li>この暑さはなんなんだろう。</li></ul>
<ul class="list1" style="padding-left:16px;margin-left:16px"><li><strong>ＢＢＲ-４ＭＧ</strong>を買った。</li></ul>
<ul class="list1" style="padding-left:16px;margin-left:16px"><li>しかも新品でだ。正気の沙汰ではないなぁ。暑さのせいか？</li></ul>
<p>さて、このルーターでＷＬＡＮ　ＡＰを作ろうと思うが、はたして気力が続くだろうか？</p>
<ul class="list1" style="padding-left:16px;margin-left:16px"><li>中古のＡＰを買っといたほうが良かったかなぁ・・・とすでに後悔先に立たず。</li></ul>
<ul class="list1" style="padding-left:16px;margin-left:16px"><li>だめだめだぜ。すでに<strong>ＡＶＲとは何の関係もない展開。</strong></li></ul>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h4 id="content_1_1">ＵＳＢ　３.０  <a class="anchor_super" id="w04b538f" href="#w04b538f" title="w04b538f"> </a></h4>
<p>ＭｙＣＯＭジャーナル連載記事</p>
<ul class="list1" style="padding-left:16px;margin-left:16px"><li><a href="http://journal.mycom.co.jp/articles/2007/09/27/idf01/002.html" rel="nofollow">http://journal.mycom.co.jp/articles/2007/09/27/idf01/002.html</a></li></ul>
<p>引用</p>
<pre>＞USB 3.0の信号にはPCI Express Gen2のx1 Laneの物理層(Electrical層とLink層)を
＞そのまま流用した。ただし流用したのはここまでで、Transaction層は全く独自となる。 

＞ソフトウェア面では、USB 2.0までのソフトウェアスタックをそのままUSB 3.0でも
＞「なるべく」採用する。これにより、USB 2.0→USB 3.0への移行に要する手間をなるべく抑える。</pre>
<p>ふーん。</p>
<p>ますますＡＶＲとは無縁の方向だな。</p>
<p>LowSpeed , FullSpeed , HighSpeed と来て、<strong>次は何と呼ぶのか</strong>だけが興味の的だ。</p>
<p>いやいや、もしかしたらマイクロフレームの次にナノフレームが出来るかもしれないし、
超ハイスピードハブをＡＶＲとＰＣの間に挟むことでＰＣから見たらＡＶＲ側が超ハイスピードデバイスに見えるのかもしれないという予測が当たったら笑えるというただそれだけだ。</p>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h4 id="content_1_2">ＢＢＲ-４ＭＧは、一瞬でＬｉｎｕｘＢｏｘになった。  <a class="anchor_super" id="hb963503" href="#hb963503" title="hb963503"> </a></h4>
<p>びんずめ堂　BBR-4MG::Linux化ファームウェア</p>
<ul class="list1" style="padding-left:16px;margin-left:16px"><li><a href="http://www.binzume.net/library/bbr-4mg06.html" rel="nofollow">http://www.binzume.net/library/bbr-4mg06.html</a></li></ul>
<ul class="list1" style="padding-left:16px;margin-left:16px"><li>びんずめ堂さんのＬｉｎｕｘ化ファームのおかげで、半田ごても改造も一切なしで（そうだ、蓋さえも開けることなく<a id="notetext_1" href="#notefoot_1" class="note_super" title="嘘。ＦｌａｓｈＲＯＭのメーカーを...">*1</a>　）、
新品のＢＢＲ-４ＭＧはものの３分もしないでＬｉｎｕｘ　Ｂｏｘになってしまった。</li></ul>
<p><strong>凄すぎる。</strong></p>
<ul class="list1" style="padding-left:16px;margin-left:16px"><li>２ＭのＦｌａｓｈによくこれだけ詰め込めますな。</li></ul>
<p>BBR-4MGを改造してlinuxルータにする計画</p>
<ul class="list1" style="padding-left:16px;margin-left:16px"><li><a href="http://www.fenix.ne.jp/~thomas/memo/bbr4/" rel="nofollow">http://www.fenix.ne.jp/~thomas/memo/bbr4/</a></li></ul>
<ul class="list1" style="padding-left:16px;margin-left:16px"><li>こちらのほうは、ＵＳＢを繋ぐために基板を改造して４８ＭＨｚの水晶モジュールを接続して、ＵＳＢメモリー
にファイルシステムを置くタイプ。（ファームはＵ-ＢＯＯＴだけを入れている）</li></ul>
<ul class="list1" style="padding-left:16px;margin-left:16px"><li>ＢＢＲ-４ＨＧのほうは２０００円くらい高いが、おそらく付属品（ＬＡＮケーブル）とファームが違うだけなんじゃなかろうか。</li>
<li>ＦＬＡＳＨはｉｎｔｅｌだった。</li>
<li>ＡＤＭ５１２０Ｐはｉｎｆｉｎｅｏｎ製のようだ。（ＡＤＭｔｅｃｈと違うの？）
<ul class="list2" style="padding-left:16px;margin-left:16px"><li>（ADMtechはinfineonに買収されたらしい）</li></ul></li>
<li>さすがに１７５ＭＨｚなので熱くなる。</li>
<li>５．５Ｖ９００ｍＡの電源は重い。トランスのようだ。５Ｗ程度？買ってきた箱には定格３．５５Ｗと書いてある。</li></ul>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h4 id="content_1_3">ＡＶＲｔｅｒｍは１９２００に追いついてない。  <a class="anchor_super" id="n5def008" href="#n5def008" title="n5def008"> </a></h4>
<ul class="list1" style="padding-left:16px;margin-left:16px"><li>久しぶりにH8/3048FをUSBに繋ぐ。（１９２００）</li>
<li>ＶＩＡのＵＳＢホストだと文字化けする。</li>
<li>ＳｉＳならＯＫ。</li></ul>
<p>えーと、ＶＩＡだとＵＨＣＩなので、７バイト受信トランザクションに４ｍＳ。</p>
<ul class="list1" style="padding-left:16px;margin-left:16px"><li>ってことは１秒に１７５０バイト。</li>
<li>ボーレートにすると１４０００ボー。
<br />
<span style="font-size:24px">バッターアウト！</span></li></ul>
<ul class="list1" style="padding-left:16px;margin-left:16px"><li>ＶＩＡだめだめじゃん。</li>
<li>っていうかＡＶＲｔｅｒｍ使うためにＨｉＳｐｅｅｄハブかＮＥＣのＵＳＢホスト買ってくる必要があるなんて・・・ナンセンスだよなー</li></ul>
<ul class="list1" style="padding-left:16px;margin-left:16px"><li>送信パケットのペイロードは４バイトより増やせないけれど、受信パケットを１６とか３２にしておいて、ＡＶＲ側が可変長パケットで応答するというふうに変更しようかな・・・。面倒だけど。</li></ul>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h4 id="content_1_4">ＡＶＲｔｅｒｍは１９２００に追いついた。  <a class="anchor_super" id="y31b10ce" href="#y31b10ce" title="y31b10ce"> </a></h4>
<ul class="list1" style="padding-left:16px;margin-left:16px"><li>コントロール転送時の受信パケットを２４バイトに増やした。
<pre>./checksize main.bin
ROM: 1722 bytes (data=4)
RAM: 109 bytes</pre>
３２バイトに増やすとたぶんスタックが足りない。</li>
<li>ＡＶＲ＿ｔｅｒｍも改造。</li>
<li>Ｈ８/３０４８Ｆのモニターと交信できた。</li>
<li>文字落ちしなくなった。</li></ul>
<p>ついでにＷ３２＿ｔｅｒｍのほうも同じプロトコルに改造した。</p>
<ul class="list1" style="padding-left:16px;margin-left:16px"><li><strong>Ｗ３２＿ｔｅｒｍを使用してＨ８/３０４８Ｆとの交信に初成功</strong>
<br />
<br />
<span style="font-size:32px">おめでとう。俺</span>　これでＨ８はめでたくWindowsの仮想ＣＯＭ：ポートに接続完了だ。
<br /></li></ul>
<ul class="list1" style="padding-left:16px;margin-left:16px"><li>ちなみにＵＳＢホストはインテル（ＵＨＣＩ）でハイスピードハブなし直結だ。</li></ul>
<p><strong>解説：</strong></p>
<ul class="list1" style="padding-left:16px;margin-left:16px"><li>ＵＨＣＩは１回のコントロール転送（ベンダリクエスト＋８バイト受信）のトランザクションに４フレーム（＝４ｍＳ）を費やす。</li>
<li>ＡＶＲ＿ｔｅｒｍではそのトランザクションで７バイトの受信データを転送するので都合１４０００ボーが転送スループットの最大である。</li>
<li>Ｈ８/３０４８Ｆのモニターは１９２００ボーに設定されている。</li>
<li>間に合わない。</li></ul>
<p><br />
そこで、１トランザクションでの受信要求サイズを２４に増やした。</p>
<ul class="list1" style="padding-left:16px;margin-left:16px"><li>１回のコントロール転送ではベンダリクエスト（８バイト）＋受信データ（可変長）最大２４バイトを受け取るように改良した。</li>
<li>２４バイトの転送が発生すると２フレーム増加し６ｍＳになるが転送量は２３文字に増えるため、３８００バイト/秒のスループットが稼げる。</li>
<li>これはビットレートに換算すると３０４００ボーだ。</li>
<li>これでも３８４００に達しないところが凧であるが・・・</li>
<li>こうしておけば、ハイスピードハブを挟むだけでこの３倍くらいはいけるようになる（はずだ）</li></ul>
<p>（マイクロフレームのおかげ・・・）</p>
<ul class="list1" style="padding-left:16px;margin-left:16px"><li>ＡＶＲ側のメモリー的にはＲＳ２３２Ｃ受信バッファ（ＦＩＦＯ）が３２バイトとＵＳＢ転送バッファ（ＰＡＣＫＥＴバッファ）２４バイトでだいぶ圧迫される。</li>
<li>これを１つにまとめられれば一挙にメモリー節約になるのだが・・・</li>
<li>たぶんigorさんのはまとめているのだろう。</li>
<li>なんとなく・・・チト無理か。</li></ul>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h4 id="content_1_5">usbdrvasm16.S解読  <a class="anchor_super" id="if7e6d57" href="#if7e6d57" title="if7e6d57"> </a></h4>
<p>このソースは<strong>芸術品</strong>だ。</p>
<ul class="list1" style="padding-left:16px;margin-left:16px"><li>クロック数のとおり寸分違わず時を刻むＣＰＵのなんと有難いことよ。</li>
<li>今どきのＣＰＵはキャッシュがあるのでタイミングなんて合うわけない。</li></ul>
<p><br /></p>
<ul class="list1" style="padding-left:16px;margin-left:16px"><li>で、受信の同期取りはleapという８ビット変数だが。</li>
<li>初期値＝０</li>
<li>１ビット読むたびに-3</li>
<li>８５回で-２５５（＝＝１）</li>
<li>１バイトは８５.３３３３３cycles</li>
<li>最後に１引いて正（＋）だったら３足して１サイクルＮＯＰ。</li>
<li>「最後に」というのは１バイト受信後である。つまり１ビット単位でのleapはやってない。</li></ul>
<p>さっぱり分からん。</p>
<ul class="list1" style="padding-left:16px;margin-left:16px"><li>単純化するならば、８５.３３３３という周期を生成したいなら、</li>
<li>｛８５，８５，８６｝（のくりかえし）というふうにすればよい。</li>
<li>ほんとにバイト単位で３バイトに１回の１サイクル挿入をやっているのかどうか<a id="notetext_2" href="#notefoot_2" class="note_super" title="正確にはビットスタッフを含めた８...">*2</a></li>
<li>読解する力が足りない・・・</li></ul>
<p><br /></p>
<ul class="list1" style="padding-left:16px;margin-left:16px"><li>送信は00101010（０ｘ２Ａ）というビットパターンをbitcntに入れる。</li>
<li>lsr bitcntするので、右から数えて、
<pre>10, 11, 10, 11, 10, 11, というクロック進行になる。</pre></li>
<li>あとの２ビットはどうするかって？そりゃアンロールされたほうのルーチンで制御だ。(didStuff6,didStuff7)</li>
<li>送信についてはleapは使っていない。たぶん10.5cycle/bit固定なのだろう。</li>
<li>誤差が10.6666 vs 10.50000(?) = 0.16666 / 10.6666 と1.5％くらいあるが、ＵＳＢの許容範囲らしい。</li>
<li>むしろ10,11,10,11のジッターのほうが気になる・・・。
</li></ul>
<p>昔、磁気ドラムの回転（に同期するように）うまく利用して書かれた（大型？）計算機のプログラムがあったらしいが（ハッカーズディクショナリに書いてあった奴）、それに匹敵するくらいのトリックだ。</p>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h4 id="content_1_6">メルの物語  <a class="anchor_super" id="g7d00efe" href="#g7d00efe" title="g7d00efe"> </a></h4>
<p>磁気ドラムの話は、うろおぼえだったので、Google先生に聞いてきた。<br />
たぶんこれ。ちょっと極端かもしれない。</p>
<ul class="list1" style="padding-left:16px;margin-left:16px"><li><a href="http://www.catb.org/jargon/html/story-of-mel.html" rel="nofollow"> http://www.catb.org/jargon/html/story-of-mel.html </a></li></ul>
<hr class="full_hr" />

<div class="jumpmenu"><a href="#navigator">&uarr;</a></div><h4 id="content_1_7">usbdrvasm16.Sを読み返すと・・・  <a class="anchor_super" id="o23ed561" href="#o23ed561" title="o23ed561"> </a></h4>
<ul class="list1" style="padding-left:16px;margin-left:16px"><li>やはり予想通り、受信時もEven bitとOdd bitで所要クロックを変えてある。</li>
<li>クロック進行は10,11,10,11,10,11だ。</li>
<li>これだと平均クロックが10.5000になり、１６ＭＨｚで必要な10.66666cycle/bitと比べて
１.５％程度速いコード進行になる。</li>
<li>８ビットで10.5×8＝８４クロックだ。</li>
<li>しかし、正確な８ビットの時間は８５.３３３３３cycleなので、１バイト受信ごとに１クロック遅れるようにしてさらに３バイトに１回で１クロック遅れさせると８５.３３３３３cycle/byteを達成できる。</li>
<li>１.５％の誤差は１バイト単位でスタートビットの同期合わせが出来るＲＳ２３２Ｃでは問題にならない<a id="notetext_3" href="#notefoot_3" class="note_super" title="スタート、ストップビットまで合わ...">*3</a>が、</li></ul>
<ul class="list1" style="padding-left:16px;margin-left:16px"><li>ＵＳＢの最大パケット長はペイロードだけでも８バイトあるので（ＰＬＬ的な処理でも入れない限りは）累積誤差<a id="notetext_4" href="#notefoot_4" class="note_super" title="荒っぽく１６バイト時間＝１２８ビ...">*4</a>でエラーを起こすことになる。</li></ul>
<p><strong>このソースは「メルの物語」に匹敵するほどの価値があると思う。</strong></p>
<hr class="full_hr" />
<p>目次</p>
<div class="contents">
<a id="contents_1"></a>
<ul class="list3" style="padding-left:16px;margin-left:16px"><li><a href="#j13e9237"> もう１０月 </a></li>
<li><a href="#w04b538f"> ＵＳＢ　３.０ </a></li>
<li><a href="#hb963503"> ＢＢＲ-４ＭＧは、一瞬でＬｉｎｕｘＢｏｘになった。 </a></li>
<li><a href="#n5def008"> ＡＶＲｔｅｒｍは１９２００に追いついてない。 </a></li>
<li><a href="#y31b10ce"> ＡＶＲｔｅｒｍは１９２００に追いついた。 </a></li>
<li><a href="#if7e6d57"> usbdrvasm16.S解読 </a></li>
<li><a href="#g7d00efe"> メルの物語 </a></li>
<li><a href="#o23ed561"> usbdrvasm16.Sを読み返すと・・・ </a></li></ul>
</div>

<hr class="note_hr" /><a id="notefoot_1" href="#notetext_1" class="note_super">*1</a>
<span class="small">嘘。ＦｌａｓｈＲＯＭのメーカーを調べるためと、ＣＰＵの発熱具合を知るために一回フタ開けた</span><br />
<a id="notefoot_2" href="#notetext_2" class="note_super">*2</a>
<span class="small">正確にはビットスタッフを含めた８ビット時間ごとに１回分の挿入と２４ビット時間ごとに１回分の挿入が必要なはずだが、正味１バイトデータに対して１回の挿入になっているので誤差をどうやって処理しているのか解読出来なかった</span><br />
<a id="notefoot_3" href="#notetext_3" class="note_super">*3</a>
<span class="small">スタート、ストップビットまで合わせて１０ビットあるから１.５×１０＝１５％。パルス中央に対して最大１５％ずれてもなんとか許容できる</span><br />
<a id="notefoot_4" href="#notetext_4" class="note_super">*4</a>
<span class="small">荒っぽく１６バイト時間＝１２８ビット時間を仮定すると１.５％×１２８＝１９２％もずれて別のビットを読んでしまう</span><br />   </div>
  </div>
 </div>
 <div style="clear:both;height:1em;"></div>
 <div id="logo"><a href="FrontPage.html"><img src="http://psp.dip.jp/web/title.jpg"></a></div>

 <div id="personal"><ul><li class="login"><a href="#">ログインまたはアカウント作成</a></li></ul></div>
 <div id="footer">
  <div id="f-officialico">
   <a href="http://pukiwiki.sourceforge.jp/"><img src="image/b_pukiwiki.official.png" alt="PukiWiki-official" /></a>
  </div>
  <div id="f-officialdevico">
   <a href="http://pukiwiki.sourceforge.jp/dev/"><img src="image/b_pukiwiki.dev.png" alt="PukiWiki-dev" /></a>
  </div>
  <div id="f-list">
   <ul><li>Site admin: <a href="http://pukiwiki.example.com/">anonymous</a></li>    <li>convert time: 0.101 sec</li>
    <li>Powered by PukiWiki</li>
    <li><a href="http://www.luntf.com/">Monobook for PukiWiki</a></li>
   </ul>
  </div>
  <div style="clear:both;"></div>
 </div>
</div>
</body>
</html>
