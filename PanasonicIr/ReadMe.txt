
                 AVR を使用した赤外線リモコン
                 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~

■ 概要

  これは、ATtiny2313を使用した赤外線リモコンです。

■ 動作説明



お約束

■ ビルド環境

-	コンパイラはavr-gcc 4.3.3 を使用しました。
-	4.x系のAVR-gccは、極力関数インライン展開することでパフォーマンスを得ています。
	が、tiny2313では、メモリーオーバーするので -finline-limit=1 オプションを与えて回避します。


■ 配線図

                  ATtiny2313

                              GND----------------> To:
           +------------------RESET--------------> AVR
           |      ___    ___
RESET      +-----[1  |__| 20] Vcc ---------------> ラ
PD0(RxD)         [2       19] PB7(SCK)----------->  イ
PD1(TxD)         [3       18] PB6(MISO)---------->   タ
XTAL2(PA1)       [4       17] PB5(MOSI)---------->    ー
XTAL1(PA0)       [5       16] PB4
PD2              [6       15] PB3
PD3              [7       14] PB2
PD4              [8       13] PB1
PD5              [9       12] PB0
GND              [10      11] PD6
                  ~~~~~~~~~~~    

	キーボードマトリクス.

weak pull-up
 (sense)
   PB0 ---+---+---+---+---+
          |   |   |   |   |
   PB1 ---+---+---+---+---+
          |   |   |   |   |
   PB2 ---+---+---+---+---+
          |   |   |   |   |
   PB3 ---+---+---+---+---+
          |   |   |   |   |
   PB4 ---+---+---+---+---+
          |   |   |   |   |
         PD2 PD3 PD4 PD5 PD6 
     SCAN (pull-down or Hi-Z)

   PA0は赤外LED正論理出力 / PA1 はチェック用LED負論理出力.

   ---------------------------------------
   XTAL:    内蔵RC発振のため未実装
   PD0(RxD) USART --- USB経由などでPCに繋ぐ
   PD1(TxD) USART --- USB経由などでPCに繋ぐ
   RESET:   10kΩ程度で5V Pullupする.
   Vcc:     3V (乾電池駆動)
   GND:     GND
   ---------------------------------------



■ FUSE設定

ヒューズの設定例は、以下のように設定します。

Low: 01100010 (0x62)
     ||||++++-- CKSEL[3:0] システムクロック選択
     ||++-- SUT[1:0] 起動時間
     |+-- CKOUT (0:PD2にシステムクロックを出力)
     +-- CKDIV8 クロック分周初期値 (1:1/1, 0:1/8)

High:11-11111 (0xFF)
     |||||||+-- RSTDISBL (RESETピン 1:有効, 0:無効(PA2))
     ||||+++-- BODLEVEL[2:0] (111:Off, 110:1.8, 101:2.7, 100:4.3)
     |||+-- WDTON (WDT 0:常時ON, 1:通常)
     ||+-- SPIEN (1:ISP禁止, 0:ISP許可) ※Parallel時のみ
     |+-- EESAVE (消去でEEPROMを 1:消去, 0:保持)
     +-- DWEN (On-Chipデバッグ 1:無効, 0:有効)

Ext: -------1 (0xFF)
            +-- SPMEN (SPM命令 1:無効, 0:有効)

現在の動作クロックは、内蔵発振４ＭＨｚの1/8分周により500kHz 動作となっています。

消費電流は3Vで0.5mA程度です。---> sleep命令の直前のポート書き込み値が間違っていました。
           修正後は、テスター10mAレンジでは計測不能な程度に減りました。

■ ソースファイルの説明.

main.c    : メイン処理.
timer.c   : タイマー１.
usart.c   : USART

■ 赤外線の信号

-38kHzで変調.


On     +---+   +---+   +---+
       |   |   |   |   |   |
Off ---+   +---+   +---+   +

     |<----->|
       26.3uS

実際はOnのデューティを15%程度にまで落として、電池の消費とLEDの劣化を防いでいます。


-bit0
 38kHzを21回

  
  +---+   +---+   +---+
  |   |   |   |   |   |
  +   +---+   +---+   +---------------
  9,000uS                 4,500uS 


■ キー操作

 CHボタンで SHARP/PANA切り替えを行なっています。

 有効なボタンは電源、１〜１２チャネル、音量＋、音量ーです。

