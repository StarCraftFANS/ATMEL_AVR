[2010-08]]←　→[[ARM]]　[[armon]]　[[stm32f103]]　[[ＡＶＲ／ＰＩＣ両用ライター](pic18spx.md) 　[usbシリアル変換](usbserial.md) 　[usbキーボード](pic18hidkey.md) 　[簡易ロジアナ、赤外線リモコン信号観測](pic18spx.md) 


### ９月：秋？
~
もしくは秋の月：秋月

~
- - - -
## 先月のまとめ
- ARM用のHID Bootloaderをでっちあげてみる。--- [armon](armon.md) 、[LPCXpresso](LPCXpresso.md) の項を参照のこと。
    - 制覇した基板は、STM8S-Discovery,CQ-STARM,STBEE,STBEE-Mini、それから、LPC1343:LPCXpresso,ARMマイコン パーフェクト学習基板 TRZ1010N。

<!-- dummy comment line for breaking list -->

~

**今月の目標**
- OpenOCDのWindowsビルドに挑戦。

<!-- dummy comment line for breaking list -->
~
~

~
~
~
~
~
~
- - - -
## Netduino
スイッチサイエンス
- [http://www.switch-science.com/products/detail.php?product_id=393](http://www.switch-science.com/products/detail.php?product_id=393) 
- ~~2800円だそうだ。~~ --- （2800円は8月31注文分までの特別価格だったらしい。）
- チップはAtmelのやつ。

<!-- dummy comment line for breaking list -->

Netduino本家
- [http://www.netduino.com/netduino/specs.htm](http://www.netduino.com/netduino/specs.htm) 

		 ● Atmel 32-bit microcontroller
		 ● Speed: 48MHz, ARM7
		 ● Code Storage: 128 KB
		 ● RAM: 60 KB
- 実はC#に興味はないので、普通にCで動かせるなら１枚くらい持っててもいいかな。
- 容量、CPUクロック的には~~ごく普通~~で、命令セットもごく普通のARM7(ARMとThumbの両方OK)。
    - 嘘：AT91SAM7x512なので、Flash512K,RAM128Kらしい。
    - で、何で128KしかRAMがないのに、Code Storage 128K + RAM 60Kなんだろう？？？
    - Code StorageはもしかしてFlash側に書くのかな？

<!-- dummy comment line for breaking list -->


- Arduinoと基板サイズなどが互換なのでシールドが使いまわせるのではないかと。

<!-- dummy comment line for breaking list -->


~
~
~
~
- - - -
## コモドール64型PC、ホリデーシーズンに発売
- [http://japanese.engadget.com/2010/08/27/c64/](http://japanese.engadget.com/2010/08/27/c64/) 
- ビックリマシーン(VIC1001とかそんな型番だった奴)

<!-- dummy comment line for breaking list -->

- 当然VICエミュレータとかROMとか付けて欲しいところ。

<!-- dummy comment line for breaking list -->


~
~
~
~
- - - -
## LPC1343:とりあえず、BOOT-ROMの逆アセンブルなどやってるんだけど・・・
- ARM(Thumb2)のアセンブラソースなんて、読めたもんじゃないね。まるでSH2だ。
- こっそり[貼っとく。](https://github.com/iruka-/ATMEL_AVR/blob/master/web/upload/LPC/bootrom.txt) 
- で、たぶん、LPC1343 users manualのメモリーマップに書いてある、

		flash controller (0x4003_c000)
- を叩いている箇所を探せばいいのだろうとあたりをつけてみたけれど
- LPCのヘッダーには、そのアドレス定義も、構造体定義も存在していない。
- users manualには

		Table 56. Flash configuration register (FLASHCFG, address 0x4003 C010) bit description
		Bit Symbol Value Description Reset  value
		1:0 FLASHTIM Flash memory access time. FLASHTIM +1 is equal to the
		   number of system clocks used for flash access.
		10
		00 1 system clock flash access time (for system clock frequencies of up to 20 MHz).
		01 2 system clocks flash access time (for system clock frequencies of up to 40 MHz).
		10  3 system clocks flash access time (for system clock frequencies of up to 72 MHz).
		11 Reserved.
		31:2 - - Reserved. User software must not change the value of
		these bits. Bits 31:2 must be written back exactly as read.
		&lt;tbd&gt;
- と、だけしか書かれていない。
- しかしBOOT-ROMのファームには4003_c000（未定義箇所：FLASHCFG=4003c010なので・・・）を参照している箇所が４つくらいあるので、ここをどうかしているのではないかと・・・（未確認）

<!-- dummy comment line for breaking list -->


~
~
~
- - - -
## LPC1343:解析の続き
- もしかしたら、LPC2xxxのFlash書き込み手順との類似性があるのではないかと気づく。
- LPC2388のUMを読んでみる。
- LPC2388のBOOTROMにはUSB接続機能はない。
- シリアルブートの機能はある。これは類似性がある。
- シリアルブートではなく、ユーザーコードからFlashプログラミングを行うIAPという機能があった。

<!-- dummy comment line for breaking list -->

~
- それはLPC1343にもあったのだ。なんで気づかなかったのだろう。

<!-- dummy comment line for breaking list -->

- The IAP routine resides at 0x1FFF1FF0 location and it is thumb code.
- The IAP function could be called in the following way using C.
- Define the IAP location entry point. Since the 0th bit of the IAP location is set there will be a change to Thumb instruction set when the program counter branches to this address.

<!-- dummy comment line for breaking list -->

	  #define IAP_LOCATION 0x1fff1ff1

- Define data structure or pointers to pass IAP command table and result table to the IAP function:

		  unsigned long command[5];
		  unsigned long result[4];
		  typedef void (*IAP)(unsigned int [],unsigned int[]);
		  iap_entry=(IAP) IAP_LOCATION;
		  iap_entry(command, result);
- ***つまり、1fff1ff1番地を呼べと。 [#ce622c58]

		Table 308.IAP Command Summary
		----------------------------------------------
		IAP Command           |Command Code
		Prepare sector(s) for write operation 50
		Copy RAM to flash      51
		Erase sector(s)        52
		Blank check sector(s)  53
		Read Part ID           54
		Read Boot code version 55
		Compare                56
		Reinvoke ISP           57
		Read UID               58
		----------------------------------------------
- command[],result[]はともに整数の配列（可変長）で、各配列の先頭アドレスを引数として与えるらしい。

<!-- dummy comment line for breaking list -->

### RTFM

- つまり、**マニュアルを読め**ということ。
- わざわざFlash Programing codeを書くことはない。BOOTROMに呼び出しエントリーがちゃんと用意されているのだ。

<!-- dummy comment line for breaking list -->

- Flash書き込みに必ずBOOT-ROMを経由する理由のひとつは、Flashの消去や書き込み中はFlashへアクセス出来ないから（おそらく異なるページにいてもだめ）なのだろう。

<!-- dummy comment line for breaking list -->

~
~
~
- - - -
## LPC1343:armon移植完了
- FlashのERASEと書き込み、それから2000番地のユーザープログラム起動まで可能になった。
- 意外と簡単だった。
- たぶんLPC2388用のarmonも同じ手法で作れるような気がした。

<!-- dummy comment line for breaking list -->

read more: [LPCXpresso](LPCXpresso.md) 

デバッグのこつはこうだ。
- アプリモードを有効にする。
- userコマンドでFlash書き換え関数のテストが出来るようにしておく。
- BOOT-ROMのリターンコードをprint出来るようにしておく。
- テストを実行する。
- リターンコードを確かめる。
- Flashがどう書き換わったかを確かめる。

<!-- dummy comment line for breaking list -->

全部armon内で実行できる。
- ジャンパーを切り替えてfirmware.binを書き込むのが一番面倒だった。（USBドライブ認識が遅いし不安定）

<!-- dummy comment line for breaking list -->


#### ToDoみたいなやつ
書いとかないと忘れるしたぶんやらない。
- ~~STM32へのバックポート~~---済み
- ~~STBEEの512kサイズに対応~~---済み
- ~~アプリモードのHIDmonが動いていたらbootmodeに戻してファーム書き換えする処理~~---済み
- bootコマンドでのシステムスタックの初期化
- pollモードの実装
- verify高速化
- LPC1343のusb disconnect処理---うまく行かない・・・。
- バスエラー対策---host側でホワイトリストを持つ。
- ・・・

<!-- dummy comment line for breaking list -->


~
~
~
- - - -
## PS3:変なJailBreakが流行っているという噂
mobilehackerz
- [http://blog.mobilehackerz.jp/2010/09/ps3psjailbreak1890.html](http://blog.mobilehackerz.jp/2010/09/ps3psjailbreak1890.html) 

<!-- dummy comment line for breaking list -->

PSGroove(git)
- [http://github.com/psgroove/psgroove](http://github.com/psgroove/psgroove) 

<!-- dummy comment line for breaking list -->

PSJailbreak reverse engineered, it's actually a unique exploit 
- [http://endlessparadigm.com/forum/showthread.php?tid=24552](http://endlessparadigm.com/forum/showthread.php?tid=24552) 

<!-- dummy comment line for breaking list -->

PSJailbreak Exploit Reverse Engineering
- [http://ps3wiki.lan.st/index.php?title=PSJailbreak_Exploit_Reverse_Engineering](http://ps3wiki.lan.st/index.php?title=PSJailbreak_Exploit_Reverse_Engineering) 

<!-- dummy comment line for breaking list -->

2ch
- [http://yuzuru.2ch.net/test/read.cgi/gameurawaza/1283404431/](http://yuzuru.2ch.net/test/read.cgi/gameurawaza/1283404431/) 
- PS3なのにAT90USB162とかteensyという単語が入ってくる。何故だぁ？
- そもそもPS3はゲーム機なんだから、電子工作とかATMELは関係ないだろ。

<!-- dummy comment line for breaking list -->

苺も大迷惑だな
- 使い道がほとんどないと思われていたAT90USBが脚光を浴びるなんて・・・

<!-- dummy comment line for breaking list -->


~
- で、このpsjailbreakのopensource cloneであるpsgrooveの正体はなんなんだ？
- HUB Device ????

<!-- dummy comment line for breaking list -->

EMUonPSP(08/27)
- [http://emuonpsp.net/](http://emuonpsp.net/) 

<!-- dummy comment line for breaking list -->

引用
	(1)PS Jailbreakで使われているチップはPIC18F44で、ソフトウェア的にUSBデバイスを実現可能
	(2)PSJailbreakは6ポートUSBハブとしてPS3からは見える。更にそのエミュレーションされた6ポートのUSBハブへ
	　　繋がったり切れたりするUSBデバイスもエミュレーション出来る
	(3)そのうちの一つのデバイスはSCEIのジグツールのIDを持っているため、PSJailbreakを接続すると
	　　PS3では6ポートUSBハブが繋がり、その先にはジグツールが繋がっているように見える(エミュレートされたUSBデバイス)
	(4)PS3はUSBデバイスが接続された時、USBデバイスのコンフィギュレーションディスクリプタ(設定データ)を読み込む
	(5)PSJailbreakがエミュレーションしているUSBデバイスのコンフィギュレーションディスクリプタはそのサイズが大きく、データの中身は
	　　PPC向けのコード+exploitなデータで構成されている
	(6)ジグツールが短期間(数ms位)接続された後、暗号化されたデータがジグツールに転送される(exploitを利用してPPC(CELL)に
	　　先にロードしたコンフィギュレーションディスクリプタ中のPPC用のコードを実行させて実現している?)
	(7)更に数ms後、PSJailbreakは64byteのデータをPS3に返す(ジグツールとして認識されるためのデータ)
	(8)その後エミュレートされていたUSBデバイスは全部外され、PS3はジグツールが接続された時と同じ状態になっている

ユニークだが
- また面倒くさいことを!

<!-- dummy comment line for breaking list -->

PIC18F2550でも出来るらしい
- [http://psx-scene.com/forums/showthread.php?t=65391](http://psx-scene.com/forums/showthread.php?t=65391) 

<!-- dummy comment line for breaking list -->
~
~
~
- - - -
## LPC1343:クロックアップに挑戦だ!!
- 秋なので、無謀なことを試みてみる。
- [lpc-armon](LPCXpresso.md) を起動。
- アプリケーションモードに切り替え（あらかじめmain-2000.hexをbootloaderで書いておく）

		ARM&gt;boot 2000
		ARM&gt;q
- 再度、立ち上げて、ＬＥＤが点滅することを確認。

<!-- dummy comment line for breaking list -->

次。
- Table 55.PLL configuration examples

<!-- dummy comment line for breaking list -->
|PLL input frequency(Fclkin)| Main clock(Fclkout) | MSEL bits |M divider | PSEL bits |P divider  |FCCO clock  |
|12 MHz|72 MHz|00101|6|01|2|288 MHz|
|12 MHz|48 MHz|00011|4|01|2|192 MHz|
|12 MHz|36 MHz|00010|3|10|4|288 MHz|
|12 MHz|24 MHz|00001|2|10|4|192 MHz|

- で、MSEL,PSELは40048008番地にある

<!-- dummy comment line for breaking list -->

	          |0|PSEL| MSEL|
	4004_8008 |7|65  |43210|

早速、MSEL,PSELの値を確認、上記Table55の通り。
	ARM> ew 40048008
	40048008 25
- 現在12MHz x 6 = 72MHz

<!-- dummy comment line for breaking list -->

では、書き換えてみる。
	ARM> ew 40048008 26　＃12MHz x 7 = 84MHz
	ARM> ew 40048008 27　＃12MHz x 8 = 96MHz
	ARM> ew 40048008 28　＃12MHz x 9 =108MHzこれはＬＥＤが点滅しない。
	ARM>  ＃無反応になる。
	^Cバッチ ジョブを終了しますか (Y/N)? y

- 結局、96MHzまでしかクロックアップ出来ない。
- ただし、96MHzでの耐久テストは行っていないので、96MHzでちゃんと動くとは言えない。ＬＥＤの点滅は行われているようだ。

<!-- dummy comment line for breaking list -->

- LPCXpresso,TRZ1010Nともに同じ結果だった。
- 108MHzは、内蔵のクロック(FCCO)がその４倍である432MHzで発振しなければならないがそれは無理（320MHzまでしか行かないらしい）
- なので、PSEL=00(/2モード)にすべきなのだが、PSEL=00ではMSELを幾つにしても無反応になるようだ。

<!-- dummy comment line for breaking list -->

~
こんな風に、armon(HIDmon)の面白いところは、思い立ったらすぐにポートの値を書き換えて気軽に試せる点だ。
- 新たにソースを起こしたり、コンパイルしたりする必要がないのが楽。

<!-- dummy comment line for breaking list -->

~
~
- - - -
## LPC1343:クロックダウンに挑戦だ!!
- こんどは遅いほうをやってみた。

<!-- dummy comment line for breaking list -->
|PLL input frequency(Fclkin)| Main clock(Fclkout) | MSEL bits |M divider | PSEL bits |P divider  |FCCO clock  |
|12 MHz|72 MHz|00101|6|01|2|288 MHz|
|12 MHz|48 MHz|00011|4|01|2|192 MHz|
|12 MHz|36 MHz|00010|3|10|4|288 MHz|
|12 MHz|24 MHz|00001|2|10|4|192 MHz|

- ＬＥＤの点滅速度で、実際のＣＰＵ動作クロックを確かめるため、アプリケーション側に切り替える。

		ARM&gt;boot 2000
		ARM&gt;q
- そして、MSEL,PSELの値を確認、上記Table55の通り。

		ARM&gt; ew 40048008
		40048008 25
- 現在12MHz x 6 = 72MHz
- 遅くしてみる。

		ARM&gt; ew 40048008 23 ＃12MHzx4=48MHz FCCO=192MHz
		ARM&gt; ew 40048008 43 ＃12MHzx4=48MHz FCCO=384MHz(規格外)
		ARM&gt; ew 40048008 42 ＃12MHzx3=36MHz FCCO=288MHz
		ARM&gt; ew 40048008 41 ＃12MHzx2=24MHz FCCO=192MHz
		ARM&gt; ew 40048008 61 ＃12MHzx2=24MHz FCCO=384MHz(規格外)
		ARM&gt; ew 40048008 60 ＃12MHzx1=12MHz FCCO=192MHz
		ARM&gt; ew 40048008 40 ＃12MHzx1=12MHz FCCO= 96MHz(規格外)
- 48MHzは素直にTable55の値のほうが良いかも。
- 12MHzはXtalと同じ周波数にすればいいので、PLLを使わずにスルーにしたほうが良いかも。
- だけど、FCCO=156MHz〜320MHzを外れても動いてるなぁ。

<!-- dummy comment line for breaking list -->

- PSEL=00では一切動かないのは何故だろう。

<!-- dummy comment line for breaking list -->



~
~
- - - -
## LPC1343:再度クロックアップに挑戦
- こんどは、FCCOの変化が起きない様に騙す手法を試してみた。
- 最初の手順は同じ。

<!-- dummy comment line for breaking list -->

MSEL,PSELの値を確認、上記Table55の通り。
	ARM> ew 40048008
	40048008 25
- 現在12MHz x 6 = 72MHz
- 一回遅くしてみる。

		ARM&gt; ew 40048008 23 ＃12MHzx4=48MHz FCCO=192MHz(PSEL=2*2)
- まず、こうすることで、FCCO（内蔵PLL発振）の周波数を192MHzに引き込んでおくのだ。
- 次に

		ARM&gt; ew 40048008 07 ＃12MHzx8=96MHz FCCO=192MHz(PSEL=1*2)
- で、PSELの分周比を1/2に減らして、MSELの分周比を２倍(x4からx8へ)に。同時に切り替える。

<!-- dummy comment line for breaking list -->

こうすると、FCCOの周波数は変わらないので、PLLの引き込みで大幅な周波数変更が起きない
- つまり、過渡的にに「動作不能なPLL周波数」になりにくくなる。

<!-- dummy comment line for breaking list -->

- 96MHzで動くようだ。
- 耐久テストは行っていないので、安定して96MHzで動くわけではないが、こんどはFCCOの発振周波数は規格内のままオーバークロッキングすることが出来た。

<!-- dummy comment line for breaking list -->


~
~
~
- - - -
## 例の300MHzのARM9搭載ノート風PDA:14,970円の実物を見てきた。
近所のパソコン屋に実物があった。
- [http://akiba-pc.watch.impress.co.jp/hotline/20100619/ni_cnote7.html](http://akiba-pc.watch.impress.co.jp/hotline/20100619/ni_cnote7.html) 
- 日本語キーボードだったので買わない。
- そのまえにOSがWindowsCEだったので要らない。
- ubuntuとかandroidに載せかえられる可能性があるなら（自力では嫌!!）、買ったかもしれない（但し英語キー限定で）

<!-- dummy comment line for breaking list -->

７９９９円の似たようなWinCE機をAndroid化している人は居るらしい。
- [http://memoro.cocolog-nifty.com/blog/2010/08/httppachimontv.html](http://memoro.cocolog-nifty.com/blog/2010/08/httppachimontv.html) 
- 日本語キーに目をつぶり、いっちょ買ってみるか。

<!-- dummy comment line for breaking list -->

こんなもんが作れるんだったら、いっそのこと**玄箱Pro**みたいに、ＯＳ移植キットだけ入れて、あとはマニアさん達で
好きなＯＳ入れてくださいねというスタンスで売ればいいのにとか思った。

~
ググっていたら、別の残念なネットブックが引っかかった

#### lyumobook
- [http://www.iriver.jp/product/lyumo/lyumobook/spec.php](http://www.iriver.jp/product/lyumo/lyumobook/spec.php) 
    - CPU　[Ingenic　jz4730](http://www.linux-mips.org/wiki/Ingenic)  XBurst (MIPS系 366MHz)
    - HDD　フラッシュ２GB
    - メモリー　128MB
    - 液晶　7インチ

<!-- dummy comment line for breaking list -->

スーパーのイオンで１万円〜１万５０００円程度で売られていたらしい（過去形）

~

バラしている人も居る。
- [http://noyuki.blogspot.com/2010/05/lyumo-bookxterm-12.html](http://noyuki.blogspot.com/2010/05/lyumo-bookxterm-12.html) 
- [http://blog.goo.ne.jp/shiisan_2007/e/ed5278d43a04b24fe7e174479113fab9](http://blog.goo.ne.jp/shiisan_2007/e/ed5278d43a04b24fe7e174479113fab9) 

<!-- dummy comment line for breaking list -->

残念な点はLinuxのディストリビューションが中華系でダメダメなところだ。
- ARMでなくMIPSなところも残念だが。
- これもユーザーランドぐらい自由に差し替えが効く様にさえしておいてくれれば、マニア達の格好の餌食になれるのにな。

<!-- dummy comment line for breaking list -->

EPC 700で遊ぶ
- [http://7mc.org/2009/05/14/epc_700.html](http://7mc.org/2009/05/14/epc_700.html) 

<!-- dummy comment line for breaking list -->


~
結局のところNetBookもSmartBookも、使えない試作品の屍累々という状況でAppleだけの一人勝ちになっているのが実情だ。

- うん、iPadが512MBメモリー、16GBストレージ、1GHz Cortex-A8という状況において、これ(128MB,2GB,366MHz)はないよな。
- たしかに１０年前のPCより低性能だ。

<!-- dummy comment line for breaking list -->

~
~
~
- - - -
## LPCXPresso:こんどはLinux？

- LPCXPresso(LPC3154+LPC1343基板：秋月にて2800円)のLPC3154側の回路図発見!
    - [http://www.embeddedartists.com/products/lpcxpresso/lpc1343_xpr.php?tab=res](http://www.embeddedartists.com/products/lpcxpresso/lpc1343_xpr.php?tab=res) 
- 上のHPの「Board Schematics (in pdf)」というところにもろに載っている。
- いやーBGAパッケージなので、ほんとどうしようかと思ってたところだ。
- おあつらえむきに74VCTまで載っているしUSBはhighSpeedだし。超高性能なJTAGライターになりうる。

<!-- dummy comment line for breaking list -->

~
- それから、LPC31xx/32xx用のLinuxを扱っているサイトがあった。
    - [http://www.lpclinux.com/Main/WebHome](http://www.lpclinux.com/Main/WebHome) 
- LPC3154の内蔵RAMは192kBしかないので、外付けDRAMくらいは必要そうだが、bootloader関連の情報を漁るには良いかも。

<!-- dummy comment line for breaking list -->

つまり。
- LPCXpressoは**一粒で２度美味しい**と。

<!-- dummy comment line for breaking list -->


~
~
~
- - - -
## FPGAで作るCRAY-1
- [http://chrisfenton.com/homebrew-cray-1a/](http://chrisfenton.com/homebrew-cray-1a/) 

<!-- dummy comment line for breaking list -->

CRAY-1が、１つのzipファイルに。
- cray1.zip

<!-- dummy comment line for breaking list -->

- おれにもひとつクレイ。

<!-- dummy comment line for breaking list -->

~
~
~
- - - -
## LPC3154:　LPC313x USB gadget support in Uboot
LPCLinux
- [http://www.lpclinux.com/LPC313x/LPC313xUbootUsb](http://www.lpclinux.com/LPC313x/LPC313xUbootUsb) 

<!-- dummy comment line for breaking list -->

- LPC3154(LPCXPressoのLPC-Link側CPU)はFlashやSD/MMC,シリアルEEPなどを実装

<!-- dummy comment line for breaking list -->
していない。
- かわりにDFU(DeviceFirmwareUpgrade)というUSB.orgで定義されている機能を使って

<!-- dummy comment line for breaking list -->
パソコン側から毎回ファームウェアを流し込んで起動するのだ。

- 一応セキュリティが掛かっているっぽい。詳細はNXPのuser.manual.315x.pdf などを見ると書いてある。
- 上記サイトではDFUに対応した(Linuxをブートさせるための)USBブートローダーを配布しているらしい。
    - あーでもホストＯＳはWindowsではなくLinuxだな。

<!-- dummy comment line for breaking list -->

- LPC3154にはハードウェアAES(たぶん128)デコーダーが入っているらしい。凄いな。ハードウェアの量的には

<!-- dummy comment line for breaking list -->
XORとテーブル引きが並んでいるだけだが、段数が（たぶん10段くらい）あるのでソフトウェア実装だと遅くてかなわん。
- 某ゲーム機とえらいちがいだ。

<!-- dummy comment line for breaking list -->

- USB2.0がHighSpeedだし、MMUが載っているし、SDRAMインターフェースがあるので、メモリーさえ載せればLinuxだろうが

<!-- dummy comment line for breaking list -->
WindowsCEだろうが動くらしい。（WindowsCEの場合は液晶とかつけないとだめか。）
- CPUクロックは180MHz＠1.2V。

<!-- dummy comment line for breaking list -->


[http://www.lpclinux.com/LPC313x/LPC313xGettingstartedELDK](http://www.lpclinux.com/LPC313x/LPC313xGettingstartedELDK) 
- このページの解説に従って、u-bootをDLし、パッチをあて、(gcc WinARM on Linuxで)ビルドして、ddして、unsmgdrした。
- 結果、init-u-boot.romを得た。

<!-- dummy comment line for breaking list -->

- この.romをDFU-Utilsでデバイスに転送すればLinuxが立ち上がる（？）のかな。（いや違うと思う）

<!-- dummy comment line for breaking list -->


- u-bootのほかに、もっと軽量のブートローダー(APEX)があり、LPC313xパッチも存在しているけれど、
- 残念ながら、USBブートの機能だけ欠落している（その他のシリアルとかSD/MMCとかFlashなどのブートはサポートされている）

<!-- dummy comment line for breaking list -->

- 結局u-bootしか選択肢がないというわけか。

<!-- dummy comment line for breaking list -->


DFU-UtilがLinuxコマンドラインでしか動作しないので、
- Linuxの動くネットブックとか欲しくなった。

<!-- dummy comment line for breaking list -->

~
~
~
- - - -
## Netduino , uboot , ...
[uboot](http://www.lpclinux.com/LPC313x/LPC313xUbootUsb) を、ubuntu10.04TLSで動かそうとしてみた。

- ubuntuでは、OpenMokoのdfu-utilをapt-getで取得できるようだ。（なんだ、ビルドしなくていいのか。）

<!-- dummy comment line for breaking list -->

	# apt-get install dfu-util

- そして、

<!-- dummy comment line for breaking list -->

	$ dfu-util -l
	dfu-util - (C) 2007-2008 by OpenMoko Inc.
	This program is Free Software and has ABSOLUTELY NO WARRANTY
	
	Found Runtime: [0x0471:0xdf55] devnum=0, cfg=0, intf=0, alt=0,
- これはＯＫ。PIDのdf55はdf 'U' のつもりだろう（大文字の'U'は0x55)

<!-- dummy comment line for breaking list -->

~
	
	$ sudo dfu-util -R -t 2048 -D init-u-boot.rom
- これがうまく行かない。

<!-- dummy comment line for breaking list -->

	Starting download: [##################################################]  
- この後、firmware conflictが起こって先へ進まない。
- init-u-boot.romの作り方を間違えたか・・・。
- もしかしたらinit-u-boot.romがLPC313xのEvaluation Boardでないと起動しないようになっているのかもしれないが、詳細不明だ。

<!-- dummy comment line for breaking list -->

	u-boot:     file format elf32-littlearm

	Sections:
	Idx Name          Size      VMA       LMA       File off  Algn
	 0 .text         000119a0  33600000  33600000  00008000  2**5
	                 CONTENTS, ALLOC, LOAD, READONLY, CODE
	 1 .data         00001c21  336119a0  336119a0  000199a0  2**2
	                 CONTENTS, ALLOC, LOAD, DATA
	 2 .remtext      000194d8  33613600  33613600  0001b600  2**2
	                 CONTENTS, ALLOC, LOAD, READONLY, CODE
	 3 .rodata       0000118b  3362cad8  3362cad8  00034ad8  2**2
	                 CONTENTS, ALLOC, LOAD, READONLY, DATA
	 4 .rodata.str1.1 00005809  3362dc63  3362dc63  00035c63  2**0
	                 CONTENTS, ALLOC, LOAD, READONLY, DATA
	 5 .u_boot_cmd   000005cc  3363346c  3363346c  0003b46c  2**2
	                 CONTENTS, ALLOC, LOAD, DATA
	 6 .bss          0004b820  33633a40  33633a40  0003ba38  2**5
- まさに、0x3000_0000〜にSDRAMを実装しないと動かない作り。
- config.h -> ea31xx.h

		#define CONFIG_SYS_MEMTEST_START    0x30000000  /* memtest works on */
		#define CONFIG_SYS_MEMTEST_END      0x33FFFFFF  /* 64MB of DRAM */
- 内蔵ISRAMは0x1102_8000〜0x1105_8000に実装されている。

<!-- dummy comment line for breaking list -->

~
- あうあう、LPC3152はsecure bootではないけれど、LPC3154はsecure bootがサポートされていて、

<!-- dummy comment line for breaking list -->
secure keyを記憶するNAND Flash 2kBが余分に実装されている。
- で、LPC3154はserialとDFUのみ、unsecure bootもサポートされている（らしい）

<!-- dummy comment line for breaking list -->

**カタい**な.

	

#### Netduinoはファームウェアソースが公開されている。
- [http://www.netduino.com/downloads/](http://www.netduino.com/downloads/) 
- CLRはMicrosoftのものが使われているようだ。CLRのソースらしきものは一部あるけれど

<!-- dummy comment line for breaking list -->

netduinofirmware.zip
	CLR/Core/TypeSystem.cpp 
	CLR/Core/Execution.cpp
	CLR/StartupLib/CLRStartup.cpp
- ヘッダーとか抜けている。たぶんVisutalStudio2010に丸依存しているのだろう。

<!-- dummy comment line for breaking list -->

- てっきりMonoの成果が使われているのかと思ったら、全然そうじゃなかった。
- (firmware)コード量がどのくらいなのかは分からなかった。
- CLRに乗っかっている言語なら使えるらしいのでアプリを書くときにMonoを使うとか、VisualBasicを使うとかありなのかも。（もちろんWindowsのＧＵＩ依存のコードがARM上で動くわけではないが・・・）

<!-- dummy comment line for breaking list -->



~
~
~
- - - -
## LPC2388: armon/armbootのメンテナンスを実施
- LPC1343で得られた経験を、[STM32](armon.md) と[NXP](ARM7mon.md) にバックポートしてみた。
- ほぼどれのＣＰＵでも同じようなHIDブートローダーが使えるようになった。

<!-- dummy comment line for breaking list -->

## [armon/armboot](armon.md)  移植済みの基板リスト
LPC2388用はSTM32からバックポート

|アーキテクチャー|ＣＰＵ(ベンダー)|基板名|FLASH容量|SRAM容量|
|Cortex-M3|STM32(STMicro)|[STM8S-Discovery](stm32f103.md) のSTM32側|64kB|20kB|
|||[CQ-STARM](armon.md) 　DesignWave 2008-05付録|128kB|20kB|
|||[STBEE](armon.md) 　ストロベリーリナックス|512kB|64kB|
|||[STBEE　Mini](armon.md) |128kB|20kB|
||LPC1343(NXP)|[LPCXpresso](LPCXpresso.md) 　NXPセミコンダクターズ|32kB|8kB|
||       |[TRZ1010N](LPCXpresso.md) 　トラ技増刊「ARMマイコン パーフェクト学習基板」|32kB|8kB|
|ARM7TDMI|LPC2388(NXP)|[CQ-FRK-NXP-ARM](ARM7mon.md) |512kB|64kB|



- 操作性やソースツリーはPIC18Fシリーズ用の[pic18spx](pic18spx.md) と大体同じになっている。

<!-- dummy comment line for breaking list -->

- LPC2388のFlashへの書き込みも成功した。
- ただし、LPC2388のアプリケーションブートがいまひとつ上手くいっていない。
    - LPC2388だけ、例外ベクターを自由にずらす(STM32のNVICコントローラーのような)ものを積んでいないのだ。
    - しかし、例外ベクターは０番地のハンドラー任せのままでも、LPC2388のVICレジスターに任意の割り込みアドレスを

<!-- dummy comment line for breaking list -->
（要因ごとに）設定できるっぽいので（FIQはだめかも）、なんとか工夫すればいけそうな予感はある。

read more : [ARM7mon](ARM7mon.md) 

~
armon/armbootの移植対象の数がだいぶ増えたので、ソースを日付入りtarballを持つのをやめてsvnに移行してみた。
- svnは楽かも。リリース(svn export後)のzip作成も自動化してみたり。
- まちがってファイルごみ(*.bakみたいな)をパッケージする事故はだいぶ防げるみたい。

<!-- dummy comment line for breaking list -->


~
~
- - - -
## LPC2388: Linuxは難しい・・・
- armon/armbootのLinux対応が出来ないかと、挑戦中。
- HIDデバイスのインタラプト転送が出来ない。何故？
- 引っかかってる箇所は、

		int usb_set_configuration(usb_dev_handle *dev, int configuration);
		int usb_claim_interface(usb_dev_handle *dev, int interface);
- これをやらないと、エンドポイントのアクセスができない、というやつなんだけど
- やるとエラーする。
- エラーしたときに、

		int usb_detach_kernel_driver_np(usb_dev_handle *dev, int interface);
- すればいいというおまじないがあるらしいが、やってみてもその後のインタラプト転送はエラーする(-22)
- なんでだろう・・・。

<!-- dummy comment line for breaking list -->

原因は、単純なコーディングミスだった。(detachしたあとで間違ったset_configurationする処理が残っていた・・・)

~
![https://github.com/iruka-/ATMEL_AVR/blob/master/web/jpg/ARM/armon-nxp.png](https://github.com/iruka-/ATMEL_AVR/blob/master/web/jpg/ARM/armon-nxp.png) 

とりあえず、Linux(ubuntu10.04)で動いているスクリーンショット。

read more : [ARM7mon](ARM7mon.md) 　[armon](armon.md)  （STM32でもLinux版が少し動くようになった）

~
~
~
~
- - - -
## armon/armboot: ついに、やっちまった・・・
- CQ-STARM基板を使って、[armon/armboot](armon.md) のLinux版をテスト中の出来事だ。

		$ sudo ./armboot -E
- えらい遅い。ハングか？
- Sleep()関数をsleep()につないだのが間違いだった。
    - 20m秒待つ-->20秒待つにされていた。

<!-- dummy comment line for breaking list -->

    - 正解は、usleep( n * 1000 ) らしい。

<!-- dummy comment line for breaking list -->

~
もいっかい。
	$ sudo ./armboot -E
- お、ちゃんと進んでる。
- あ、１２８ｋＢをオーバーランしてもうた。
- そうか、５１２ｋに拡張したんだっけ。
- 電源を入れなおす。起動しない。DFUはとうの昔に消えている。というかDFUだろうが何だろうがFLASHの先頭に書かれたページが消えている。

<!-- dummy comment line for breaking list -->
~

- 終了。文鎮の出来上がりだ。
- 取り急ぎ、JTAGアダプターをCQ-STARMの40pin配列（の一部JTAG端子部分)に変換するピンヘッダー基板を作る。
- （ピンヘッダーを少し曲げて、そのままCQ-STARMの40pinの一部に差込み、導通させているだけという・・・）
- JTAGでmain-0000.hexを書く。

<!-- dummy comment line for breaking list -->

復活した。
- その後、やはりバグっていて、また消してしもうた。
- - - -
- 現在公開中の[armon/armboot](armon.md) はこのバグを修正済みです。(Linuxでも動作する)
- armboot -E をしなければ（あるいは128kを越えるhexを書き込みしようとしなければ）元から無問題。
- （書き込みのほうは、自己ファーム領域を書き込まないようにガードしたんだけどなぁ）

<!-- dummy comment line for breaking list -->



~
~
~
- - - -
## uboot: やはり、動かない。
- uboot/board/ea31xx/config.mk:

		TEXT_BASE = 0x33600000
- これを

		TEXT_BASE = 0x11040000
- に変えてビルドしてみた。
- 実行。
- 動かない。

		Found Runtime: [0x0471:0xdf55] devnum=3, cfg=0, intf=0, alt=0, name="UNDEFINED"
		Claiming USB DFU Interface...
		Setting Alternate Setting ...
		Determining device status: state = dfuIDLE, status = 0
		dfuIDLE, continuing
		Transfer Size = 0x0800
		bytes_per_hash=1628
		Starting download: [##################################################] finished!
		state(8) = dfuMANIFEST-WAIT-RESET, status(10) = Device's firmware is corrupt. It cannot return to run-time (non- DFU) operations
		Done!
		can't detach: error sending control message: Broken pipe
		Resetting USB to switch back to runtime mode
- mapファイルを良く見たら、96kBはおろか、192kBに入ってない。

		Sections:
		Idx Name          Size      VMA       LMA       File off  Algn
		 0 .text         000119a0  33600000  33600000  00008000  2**5
		                 CONTENTS, ALLOC, LOAD, READONLY, CODE
		 1 .data         00001c21  336119a0  336119a0  000199a0  2**2
		                 CONTENTS, ALLOC, LOAD, DATA
		 2 .remtext      000194d8  33613600  33613600  0001b600  2**2
		                 CONTENTS, ALLOC, LOAD, READONLY, CODE
		 3 .rodata       0000118b  3362cad8  3362cad8  00034ad8  2**2
		                 CONTENTS, ALLOC, LOAD, READONLY, DATA
		 6 .bss          0004b820  33633a40  33633a40  0003ba38  2**5
- bssが256kBを越えていた。
    - libfatが192kB確保しているらしい。

<!-- dummy comment line for breaking list -->

~
- その後、いろいろ弄って.textのサイズを32kB程度に縮めてみたのだけれど、.bssと.remtestがなかなか縮まない。
- そればかりか、.remtextセクションはなぜか .textのコードがいっぱい詰まっていて、サイズも96kB以上。
- ところがmkbootimage.cが.remtextセクションを勝手に全削除してしまって、init-u-boot.romのサイズは32k未満になる。

<!-- dummy comment line for breaking list -->

全く不可解だ。
- そもそも.remtextって、何なんだ。

<!-- dummy comment line for breaking list -->

- u-bootはソース規模が大きすぎる。LPC3154のＬチカって、どっかに落ちてないかな・・・。

<!-- dummy comment line for breaking list -->

LPC3154は、ちょっと難易度高すぎたかな。

~

（NXPのサイトにある、）lpc313x.cdl.drivers.zipが、それらしい。

readme.txt

	$Id:: lpc313x_readme.txt 1633 2009-02-06 02:21:00Z pdurgesh            $
	
	NXP LPC313x Chip Support Package version 0.03
	
	************************************************************************
	************************************************************************
	* Supported chip peripherals of the CSP
	************************************************************************
	************************************************************************
	This CSP contains driver support for the following chip peripherals:
	* LPC313x USB device (Memory back Mass storage example)
	* LPC313x 10 bit ADC
	* LPC313x Color LCD controller
	* LPC313x Clock Generation Unit (CGU)
	* LPC313x CRC32 driver
	* LPC313x DMA controller (channel allocation driver only)
	* LPC313x Event Router
	* LPC313x I2C driver
	* LPC313x I2S audio
	* LPC313x Interrupt controller
	* LPC313x IPINT/PCM driver
	* LPC313x SD/MMC card controller/Memory card interface driver (MCI)
	* LPC313x PWM
	* LPC313x SPI
	* LPC313x Timer 0/1/2/3 driver
	* LPC313x UART driver
	* LPC313x Watchdog timer driver (WDT)
	* LPC313x GPIO controller (inline functions)
	* LPC313x SysCReg (register access header driver)

- CodeSourceryもサポートされていた。
- LPC313xとLPC3154は主に容量の違いなので使えそうだ。

<!-- dummy comment line for breaking list -->

- BSPというのは開発ボード毎のサポートパッケージで、CSPというのはチップ毎のサポートパッケージらしい。
- CDLはコモンドライバーライブラリだそうだ。

<!-- dummy comment line for breaking list -->


## とりあえずLPC3154用Ｌチカをでっちあげてみる。

- [test-lpc3154.zip](https://github.com/iruka-/ATMEL_AVR/blob/master/web/upload/LPC/test-lpc3154.zip) 

<!-- dummy comment line for breaking list -->

- スタートアップがKeilだかEARのアセンブラだったので全然通らない。
- とりあえずLPC2388のcrt.Sをコピペしてみたけれど、全然だめかも。
- ~~動くかどうかはまだ分からない。~~---ビクとも動かない。

<!-- dummy comment line for breaking list -->

dfu-utilが、formware corruptというエラーを吐いて止まる。
- 原因はまったくもって分からない。
- LPC3154はdfuでのnon-secureブートをサポートしているはずなのだが、
- もしかしたら内蔵のfuseのようなものでsecure-boot限定になっているのかもしれないし、
- 単純にバイナリーの作り方が間違っているだけなのかもしれない。

<!-- dummy comment line for breaking list -->

他にも、nand-bootとかsd/mmc-bootとかserial-bootとかJTAGとかいろいろ試し方は
あるけれど、BGAパッケージなので未接続ピンに何かを繋ぐことはほぼ不可能だ。

- もう諦めようかな。

<!-- dummy comment line for breaking list -->

### ほぼ諦めているけれど、ノウハウだけ書いておく。

- [test-lpc3154.zip](https://github.com/iruka-/ATMEL_AVR/blob/master/web/upload/LPC/test-lpc3154.zip) に全部入っているけれど
- init-boot.bin （＝＝ 出来たelfをbin化して512の倍数サイズにしただけ）

		000000: 23 00 00 ea 69 6d 67 41  00 00 00 00 00 00 00 00  #...imgA........
		000010: 00 00 00 00 00 00 00 00  00 00 00 00 0a 00 00 00  ................
		000020: 00 40 00 00 00 00 00 00  00 00 00 00 00 00 00 00  .@..............
		000030: 00 80 00 00 00 00 00 00  00 00 00 00 00 00 00 00  ................
		000040: 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  ................
		000050: 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  ................
		000060: 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  ................
		000070: 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  ................
		000080: 00 00 00 00 00 90 02 11  00 90 02 11 00 d0 02 11  ................
		000090: 00 10 03 11 d3 00 a0 e3  00 f0 2f e1 10 1f 11 ee  ........../.....
		0000a0: f0 20 9f e5 02 10 01 e0  10 1f 01 ee 00 10 a0 e3  . ..............
- 先頭の構造はlpc3154ユーザーマニュアルに書いてある通り。
- offset 0x1cにある 000aというのが、CRC32チェックを省くオプション。
- とりあえず、サイズは16kB(0x4000)、bssを含めて0x8000ということにしている。

<!-- dummy comment line for breaking list -->

~
- init-boot.rom（＝＝init-boot.binをunsimgcrというツールで変換したもの）

		000000: 10 00 00 e6 00 00 00 00  00 00 00 00 8e e5 ea 84  ................
		000010: a8 ef 56 b9 52 71 05 db  00 40 00 00 00 00 00 00  ..V.Rq...@......
		000020: 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  ................
		...
		000800: 0c 28 0c e8 98 60 1c 47  59 60 58 b0 3a af 4e cd  .(...`.GY`X.:.N.
		000810: 1d 2d 3b db 19 3b 19 0b  87 27 bf 30 45 a0 b7 33  .-;..;...'.0E..3
- 先頭は0xe6000010固定。
- その次は開始セクター（というかISRAM上のロード番地）で0のときが0x1102_9000番地で、1増えるたびに512だか4096だか後ろにずれていく。
    - ちなみにISRAMは0x1102_8000〜0x1105800までの192kBが実装されている。
    - 実行開始（というかロード）番地は0x1102_9000でいいとおもうけど・・・たぶん。
- 0x800以降と、先頭のほうも暗号化されている。
- unsimgcrコマンドはNXP提供品(i386-linuxのelf)
- dfuで転送するときにセクターサイズ指定を2048にする。先頭2048(0x800)がヘッダーで

<!-- dummy comment line for breaking list -->
その後ろは暗号化されたファームという感じ。
- dfuのデバイス側ブートシーケンスもlpc3154ユーザーマニュアルに書いてある通り。

<!-- dummy comment line for breaking list -->

でもブートしてくれない。

~
~
~

- - - -
## [lpc-armon](lpc-armon.md) :Linuxに対応。
- LPC1343用の armon/armboot をLinuxでも使えるように改良した。
- これで、全機種（というか全基板）Linuxから弄れるようになった。

<!-- dummy comment line for breaking list -->

read more : [lpc-armon](lpc-armon.md) 

- MacOSにも対応したいけど、自由に使えるMacOSが手元にないんだな。

<!-- dummy comment line for breaking list -->

- あ、MacOSではcode sourcery G++がないかも。クロスコンパイラも用意しないとだめなのかな。
- 自分はいつもWindowsだけでやってる。たまに（というかLinuxでないとビルドできないようなものを触るときだけ）VMWare内のubuntuを起動するか、素のLinux(常時起動しているサーバー)にログインする感じ。
- 常時起動しているサーバーは、玄箱なので遅い。:-)

<!-- dummy comment line for breaking list -->

~
~
~
- - - -
## ＬＰＣＸｐｒｅｓｓｏ　ＮＸＰ　ＬＰＣ１７６８評価キット
秋月電子
- [http://akizukidenshi.com/catalog/g/gM-04117/](http://akizukidenshi.com/catalog/g/gM-04117/) 

<!-- dummy comment line for breaking list -->

	■動作クロック周波数：７２ＭＨｚ（搭載マイコンの最大動作周波数は、１００ＭＨｚ）
	■プログラムメモリ：５１２ＫＢ
	■ＳＲＡＭ：６４ＫＢ
	■コアはＡＲＭ社のＣｏｒｔｅｘ−Ｍ３を採用

[http://akizukidenshi.com/img/goods/C/M-04117.JPG](http://akizukidenshi.com/img/goods/C/M-04117.JPG) 

寸評:
- 基板を切り離すのが毎回面倒だ。
- ターゲット側がUSB OTGなのはいいけれど、コネクタ実装されてない。
- ちゃんと100MHzにクロックアップ出来るんだ。
- またLPC3154基板が余るな。どうしよう。
- LPC1343より１００円高い。
- JTAGで書けるんだ。（LPC-LinkはJTAGをサポートしてるんだろうか？）
- SRAMは32k+32k構成で、片方の32kはUSB,Etherなどのバッファと共用だ。(LPC2388は64kの他に16k+16kある)

<!-- dummy comment line for breaking list -->

LPC2388(CQ付録)の石は適度に熱くなる（パワーが大きい）んで、乗り換えようかな。

~
~
~
- - - -
## ＬＰＣＸｐｒｅｓｓｏ　というかCode Red 縛り
やはり、ＬＰＣＸｐｒｅｓｓｏでダウンロード出来るファームのサイズは１２８ｋＢまでらしい。
- [http://www.code-red-tech.com/products.php](http://www.code-red-tech.com/products.php) 
- 256kB版は$256で、512kB版は$512（いずれも米ドル）、無制限版は$999らしい。

<!-- dummy comment line for breaking list -->

だけど、こいつ（LPCXpressoのIDE）って、Eclipse+gccだったような気が思いっきりするんだが・・・。

- つまり、LPCXpressoというのはCodeRedの~~反則~~販促品だったのか・・・。
- たいていの人はＬチカくらいしかしないので、128kでも全然オッケー（違うぞ）
- なこたあない。
    - LPC1343でなくて1768な理由はEther繋いでtcp/ipスタックくらい試す勢いの人が使うので、128kでは全然足りないという結論に達す。

<!-- dummy comment line for breaking list -->

~
思うんだけれど、LPCXpressoのLPC-Link側って、明らかにオーバースペックだよなぁ・・・。
- ターゲット側がLPC1768までなら、USBがHighSpeedである必要ないしARMコアだって72MHzで充分だろ。
- まあ、贅沢な石を使ってくれているんで文句は言えないんだけど。

<!-- dummy comment line for breaking list -->



~
~
~
- - - -
## メモ：ARM Debian/Ubuntuの上でAndroidを動かす
KMC Staff Blog:
- [http://blog.kmckk.com/archives/2965337.html](http://blog.kmckk.com/archives/2965337.html) 
- chrootを使っているらしい。
- 若干のカーネル修正が必要。

<!-- dummy comment line for breaking list -->

既存のソフトウェアをAndroidで再利用する
- [http://blog.kmckk.com/archives/2960795.html](http://blog.kmckk.com/archives/2960795.html) 

<!-- dummy comment line for breaking list -->

~
- ARMでLinuxが走る端末持ってない。１台欲しくなってきた。(iPadは却下)
- 中華系はここ（[http://pachimon.tv/](http://pachimon.tv/) ）とかこの辺で売ってる（[http://www.green-tool.jp/](http://www.green-tool.jp/) ）。

<!-- dummy comment line for breaking list -->

2chスレだと、このへん
- [http://toki.2ch.net/test/read.cgi/wm/1280206595/l50](http://toki.2ch.net/test/read.cgi/wm/1280206595/l50) 

<!-- dummy comment line for breaking list -->

Googleって、ほんとはAndroidを無料（に近い）端末として配布したかったらしいんだけど、キャリアの壁があって挫折したとかいう話を聞いた。

で、結局、中華だけが(iP*dのパチモン用ＯＳとして）盛り上がってるような感じか。

もしAndroidが無かったらほんとにAppleの独壇場になったんだろうなぁ・・と。


~
~
- - - -
## LPC2388: armon/armbootのメンテナンス完了
- HIDブートローダーとしてちゃんと動くようになった。
- user関数からprintfを試すことが出来るようになった。
- 32kBを超えるhexを正しく書き込めるようになった。
    - LPC2388のFLASHは32kB以前と0x78000以降が4kB/SECTORで、32kB以降0x78000番地までが32kB/SECTORになっている
    - ERASEやWRITEするときのページ番号は、SECTORの先頭からの数を数えて与えないといけない（番地ではない）
- Linuxからも使える。

<!-- dummy comment line for breaking list -->
~
read more : [ARM7mon](ARM7mon.md) 　[armon](armon.md) 


~
~
- - - -
## STM32 Value line Discovery

STM8S-Discoveryの COLOR(RED){燃えないゴミ} 側がパワーアップしとる。
- [http://www.st.com/mcu/contentid-133-110-STM32VLDISCOVERY.html](http://www.st.com/mcu/contentid-133-110-STM32VLDISCOVERY.html) 

<!-- dummy comment line for breaking list -->

PDFマニュアル
- [http://www.st.com/stonline/products/literature/um/17217.pdf](http://www.st.com/stonline/products/literature/um/17217.pdf) 

<!-- dummy comment line for breaking list -->

~
寸評
- 基板がもはや切り離せない。
- 燃えないゴミが32bitにパワーアップ
    - STM32F100RBT6B 128 KB Flash, 8 KB RAM 64-pin LQFP
    - Cortex-M3だが、24MHz動作
    - ターゲット側にはUSB I/Fが存在しない。
    - 12bit ADCと12bit DAC x 2 （ステレオ？？）がある。
    - HDMI(???)
    - 水晶が３個も載っている(8MHz x 2 , 32768 x 1)
    - JTAGはない。SWD専用。

<!-- dummy comment line for breaking list -->

で、値段はいくらなんだろう。まあ、アレが750円だったから980円くらい？？？(1050円かも・・・)

- ST-Link側と燃えないゴミ側の接続が２線式(SWD)だけっていうのはいただけない。
- Arduinoでさえ、RxD/TxDが繋がってfirmata出来るのに。

<!-- dummy comment line for breaking list -->

もちろん２線式でST-Link側がUSB to soft I2C converterになれるのなら、それっぽいfirmataになるけれど、
そんなファームが供給されるとは到底思えないんだ。

７５０円の片割れのほうがよっぽど[使い道](http://nemuisan.blog.bai.ne.jp/?eid=178353) があるような気がした。

~

この基板についての[詳細はここ](http://miqn.net/node/149) に詳しく載ってました。

~
~
酷い言い方で、とてもblogになんか書けないんだけど、
- SIZE(6){この基板は燃えないゴミCPUを剥いでしまってST-Link側CPUの手足をピンヘッダーに出して使うしかないと思っている。}もし買うとしたらだけど。
- 多分買わない。だってほら、もうARM基板なんてCQ出版の付録を大人買いしたストックが溜まってお腹一杯なんだ。
- そろそろPIC18Fに戻ろう。

<!-- dummy comment line for breaking list -->

~
- - - -
## そういえばOpenOCDをビルドすることをすっかり忘れてた。
- そろそろやるか。COLOR(BLUE){涼しくなったことだし。}

<!-- dummy comment line for breaking list -->


~
~
~
~
- - - -
## デルから10型タブレット / ノート Inspiron Duo、デュアルコアAtom採用
Engadget
- [http://japanese.engadget.com/2010/09/14/10-inspiron-duo-atom/](http://japanese.engadget.com/2010/09/14/10-inspiron-duo-atom/) 
- 今年始めのDELL Mini10v２万円投売りセールに乗り遅れた俺としては、こんどは乗り遅れないようにしよう。
- 英語キーが選べるのはDELLしかないし。
- これと同程度メモリーが載っててCPUがARMならなお可なんだけど。

<!-- dummy comment line for breaking list -->

ていうかこれ４万超えるのかなぁ・・・。ううむ。

- 中華Androidはどれもキーボードついてないし、まともにメモリー載ってないし、何よりubuntuが使えないんじゃあ・・・

<!-- dummy comment line for breaking list -->


~
~
~
~
- - - -
## LPC3154 questions...
Yahoo Group
- [http://tech.dir.groups.yahoo.com/group/lpc1000/message/164](http://tech.dir.groups.yahoo.com/group/lpc1000/message/164) 

<!-- dummy comment line for breaking list -->

英語良く分からないんだけれど、
- BlankのLPC3154を持っていて、それと置き換えればit will not take any custom firmwareじゃなくなるのか？？？
- そもそもブランクのLPC3154と、書き込み済みのLPC3154というところが良く分からないんだけど。
- Flash載ってないだろ。
- まさか内蔵Fuseとか小容量Flashのようなものを持っている？？？

<!-- dummy comment line for breaking list -->

~
- [http://knowledgebase.nxp.trimm.net/showthread.php?t=250](http://knowledgebase.nxp.trimm.net/showthread.php?t=250) 
- [http://knowledgebase.nxp.trimm.net/showthread.php?p=252](http://knowledgebase.nxp.trimm.net/showthread.php?p=252) 

<!-- dummy comment line for breaking list -->

なんか鍵掛かってる？そうなのか？良く分からん。



~
~
~
~
- - - -
## NXP’s 150 MHz LPC1800 MCU Delivers Industry’s Highest ARM Cortex-M3 Performance

- [http://www.nxp.com/news/content/file_1765.html](http://www.nxp.com/news/content/file_1765.html) 
- SRAM200kB,Flash1Mbって、どんだけー。
- LPCXpressoの1768版買うの少し待とう。
- ところで、Cortex-M4まだぁ？(AA略)

<!-- dummy comment line for breaking list -->


~
~
~
~
- - - -
## 「ノートPCや3D TVをiPadが喰う」：米国販売店
- [http://wiredvision.jp/news/201009/2010092120.html](http://wiredvision.jp/news/201009/2010092120.html) 
- WindowsPCからiPad化は予想以上の速度で進んでいて、
- ~~Microsoft社の存続が危うい~~ --- じゃあなくて、iPadの有力な対抗馬は（今になっても）存在しない。
- Android搭載MIDデバイス--->中華製--->品質悪すぎ（日本人がそう思うだけかもしれないが）--->逆にiPadの引き立て役にさえなっている。
- Windows7搭載ATOMデバイス--->~~遅くて使いにくい~~皆んな、Windows7は必要ないと考えている。
- ubuntu搭載SmartBook--->**Geekな人**しか買わない。--->市場が無い。

<!-- dummy comment line for breaking list -->

結論は、Appleの一人勝ち状態が継続しているということ。

~
このままいくとMicrosoft社の存続がマジやばいかもね。---MIDデバイスにWindowsCE要らない-->Android化している。MicrosoftのOS(Windows7しかないんだけど)が避けられている。ということは、もうひとつの収入の柱であるMicrosoft Officeの実行環境もどんどんパイが狭くなっていくわけで・・・。**どうする？**


~
~
- - - -
## LPC2388/LPC1343/STM32F10x : armon/armbootのメンテナンス完了
- 全機種で 'p'コマンドが使えるようになった。(portアドレスをいちいち覚えなくて良い)
- Linuxからも使える。
- host側ソースを共通化。

<!-- dummy comment line for breaking list -->

~
read more : [LPC2388用](ARM7mon.md) 　[LPC1343用](lpc-armon.md) 　[STM32用](armon.md) 　

~


~
~
- - - -
## ニンテンドー3DSはデュアルARM11 at 266MHz、1.5GBストレージ内蔵？
- [http://japanese.engadget.com/2010/09/21/3ds-arm11-at-266mhz-1-5gb/](http://japanese.engadget.com/2010/09/21/3ds-arm11-at-266mhz-1-5gb/) 
- あくまでも、**噂**レベル。

<!-- dummy comment line for breaking list -->

- でも、この文面どおりだったとしたら、SONY PSPと瓜二つ。(ARMでなくMIPSという違いはあるが)
- 3DSはTegra搭載しなかったけれど、もう片方のやつはTegraの噂が立っているらしい。
- Tegraって呪われてるからなぁ・・・（某Microsoft携帯の潰れたほう）

<!-- dummy comment line for breaking list -->


~
~
- - - -
## これはひどい：検事が押収フロッピー書き換え、8インチに─不正郵便事件
BogusNews
- [http://bogusne.ws/article/163353233.html](http://bogusne.ws/article/163353233.html) 

<!-- dummy comment line for breaking list -->

[8inchの写真を検索](http://www.google.com/images?num=50&amp;lr=lang_ja&amp;q=8%E3%82%A4%E3%83%B3%E3%83%81%E3%83%95%E3%83%AD%E3%83%83%E3%83%94%E3%83%BC&amp;um=1&amp;ie=UTF-8&amp;source=og&amp;sa=N&amp;hl=ja&amp;tab=wi) 

- しかし、1.44MBの3.5inchを8inchに移したら、何枚に増えるのかな？**２枚？**

<!-- dummy comment line for breaking list -->

~
~
- - - -
## STM32マイクロコントローラのシンクライアント
Make: Japanより
- [http://jp.makezine.com/blog/2010/09/stm32_video_thin_client.html](http://jp.makezine.com/blog/2010/09/stm32_video_thin_client.html) 

<!-- dummy comment line for breaking list -->

	http://github.com/davidcranor/Thinner-Client/blob/master/Pictures/photo%201.JPG

	NTSCのビデオ信号をすべてハードウェア内で行い、完全な480x240のフレームバッファを持つ。
	コードはすべてCで書かれている。加えて、簡単、自由にビットマップグラフィックを
	フレームバッファに描けるように、また、シリアル受信バッファ、キーボードキャラクタバッファに
	アクセスできるよう記述されている。

- シンクライアントと聞いて、全然ピンと来るものが無かった。
- だって、**Thin-Clientって、Ｘ端末のことだろ？違う？**

<!-- dummy comment line for breaking list -->

- これは、どうやら、（TTLレベル）RS-232シリアル仕様の**vt-100っぽい tty端末**のことだ。

<!-- dummy comment line for breaking list -->

	今回のプロジェクトで使用したSTM32は80MHzで動作する。
	数多くの周辺機器があり、DMA、豊富なRAM/Flash、内蔵シリアルブートローダーを備え、価格は6ドル前後。
	私はもう二度とAtmegaは使わないだろう。

- 上の２行には同意だが、最後の行には同意しかねる。
- AVRでやるから価値があるものだってあるのだ。
- (AVRよりずっと性能が高いマイコンでは、**出来るのが当たり前。**、それはちっとも面白くない)

<!-- dummy comment line for breaking list -->

~
~
- - - -
## サムスンのAndroidタブレット Galaxy Tab
Engadget
- [http://japanese.engadget.com/2010/09/22/android-galaxy-tab/](http://japanese.engadget.com/2010/09/22/android-galaxy-tab/) 
- [http://japanese.engadget.com/2010/09/24/android-galaxy-tab-9/](http://japanese.engadget.com/2010/09/24/android-galaxy-tab-9/) 
- これが、iPadの対抗馬の第一候補と目されているAndroid端末らしい。
- 7インチ1024 x 600 画面でAndroid 2.2採用。
- 380g の軽さ、microSDスロットつき 。

<!-- dummy comment line for breaking list -->

**この軽さ**が凄いよな。
- って煙草のＣＭかよ。

<!-- dummy comment line for breaking list -->

- iPadみたいに、WiFi版が出るなら買ってもよいけど。
    - 3Gでどこでも接続 (WiFi のみ版もあり)、**マジかよ。**困ったな。

<!-- dummy comment line for breaking list -->


~
~
- - - -
## Arduino UNO
GIZMODE
- [http://www.gizmodo.jp/2010/09/arduinoduemilanoveunomega.html](http://www.gizmodo.jp/2010/09/arduinoduemilanoveunomega.html) 
- FT232RLの代わりにATmega8U2がUSBチップの役割を果たしている。
- これって、ATmega328なくてもいいんじゃないか？8U2の手足をそのまま出せば。
- 互換性持たせるにはこれしかないんだろうけど、なんだかなー。
- ARMなら１チップで済むのに。

<!-- dummy comment line for breaking list -->

- 最近の傾向として、ArduinoチックなものにさえＬＷＰ（軽量プログラミング言語）が進出しているとか、Etherを持ったものが現れているので、
- もうAVRでは荷が重く、きっぱりARMに移行すべき時期なんだけど。

<!-- dummy comment line for breaking list -->



~
~
- - - -
## “Javaの父”ゴスリング氏、Oracle退社の理由を語る (2/2)
[http://www.itmedia.co.jp/enterprise/articles/1009/27/news020_2.html](http://www.itmedia.co.jp/enterprise/articles/1009/27/news020_2.html) 

	Oracleには非常に傲慢なところがある。

- ここまで読んだ。
- 最初から分かっていた？

<!-- dummy comment line for breaking list -->



~
~
- - - -
## マウス、Androidタブレット「LuvPad AD100」を発売延期
- [http://pc.watch.impress.co.jp/docs/news/20100928_396545.html](http://pc.watch.impress.co.jp/docs/news/20100928_396545.html) 

<!-- dummy comment line for breaking list -->

- 中華の嫌がらせに引っかかったか、あるいは
- Tegraって、やっぱ~~鈍われ~~呪われてる

<!-- dummy comment line for breaking list -->

~
- しかし、中華の嫌がらせはどこまでエスカレートするつもりなんだろ？
- まるで北朝鮮と同じ、というか、同じ共産党なんだよなー。無理ないか。

<!-- dummy comment line for breaking list -->


~
~
- - - -
## STM32F10x : armon/armboot用のサンプルアプリケーションを追加
- とりあえず、vcom（仮想COM）サンプルのビルドが通るようにしてみた。

<!-- dummy comment line for breaking list -->

~
read more : [STM32用armon/armboot](armon.md) 　／　[LPC1343用armon/armboot（作成途上）](lpc-armon.md) 　



~
~
- - - -
## OpenOCDのWindowsビルドに挑戦。

実は**超簡単**だったのだ。

- 一応cygwinからexeファイルを作るのには成功していたけれど、cygwin1.dll依存になるのでMinGWベースのOpenOCDが欲しかった。

<!-- dummy comment line for breaking list -->

- cygwin上にはautoconfをはじめとするconfigureに必要なツールがほぼ揃っているけれど、Windows上のMinGWでそれをやるのは難しい。

<!-- dummy comment line for breaking list -->


#### 今回は、Linux(ubuntu 10.04LTS)上でやる。

- ものの１０分もあればexeが出来上がる。

<!-- dummy comment line for breaking list -->


まず、必要そうなパッケージをapt-getで取得

	# apt-get install git-core
	# apt-get install gcc-mingw32
	# apt-get install mingw32
	# apt-get install libconfig8
	# apt-get install libtool
	# apt-get install autoconf
	# apt-get install automake
	# apt-get install cmake
	# apt-get install texinfo

- libftd2xx(CDM20602.zip)をFTDIサイトから取得して展開

<!-- dummy comment line for breaking list -->

	$ mkdir libftd2xx-win32
	$ cd libftd2xx-win32
	$ unzip ../CDM20602.zip
	$ cd ..

ファイル名はバージョンが変わると変わるかも。
- もしFTDI配布物がzipでなくexeだったら、Windows上で展開して持ってくるか、

<!-- dummy comment line for breaking list -->
wine(Windowsエミュレータ)を使って実行する。

~

- OpenOCDソースの取得

<!-- dummy comment line for breaking list -->

	$ git clone git://openocd.git.sourceforge.net/gitroot/openocd/openocd

- ビルド

<!-- dummy comment line for breaking list -->

	$ cd openocd
	$ ./bootstrap
	$ ./configure \
	       --build=i686-pc-linux-gnu \
	       --host=i586-mingw32msvc \
	       --enable-maintainer-mode \
	       --enable-ft2232_ftd2xx \
	       --with-ftd2xx-win32-zipdir=../libftd2xx-win32
	$ make

これでsrc/openocd.exe が出来上がる。
- **Linuxなのに(exeファイルが完成する)不思議。**
- MinGWのクロスコンパイラをわざわざビルドする必要もなかった。(apt-getで取得)
- 動作確認はまだ。

<!-- dummy comment line for breaking list -->

結論：
- とにかくubuntuは良い。
- 速いし、ソフトウェアパッケージはDebianと同じくらい充実しているし。
- apt-getで最新ソフトが何でも手に入る。野良ビルドの必要がほとんどない。

<!-- dummy comment line for breaking list -->

野望など：
- OpenOCDのUSB-Blaster対応はひどくのろいので、もうすこし手軽で使い物になるJTAGアダプターを作りたい。

<!-- dummy comment line for breaking list -->

~

- もちろんFTDIのチップを使えば出来る（すでに持っている）のだけれど、難点が・・・
    - 秋月FT-2232モジュールで製作する場合、シリアルEEPROMの入手と、電圧レベルコンバータの入手がネックになる。
    - 電圧コンバータを実装しない場合でも3STATEのCMOSゲートを２組ほど実装しないといけないので面倒。（手持ちだと74HC244っぽいやつ(644とか645)を２個使わないと出来ない）
    - 適当なUSBマイコン(PIC18FとかAVRとかARMとか)でやればほぼ直結でいけるのに(お互い3.3V品に限定の話)

<!-- dummy comment line for breaking list -->

- OpenOCDはソフトウェアの規模がかなりでかいので、ドライバー部分しかいじれないというか、手に負えないかも。

