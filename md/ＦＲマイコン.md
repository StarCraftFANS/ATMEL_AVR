[2008-04](2008-04.md) 

## ＦＲマイコン、来たー
- interface ２００８.５付録基板。
- 早速コネクタだけ繋いでみた。
- 通電はＯＫ。電源レギュレータが３.３Ｖと２.５Ｖを出力しているのも確認。リセットするとその間ＬＥＤが消える。とりあえず動いているのか？
- ただ、ＵＳＢコネクタを繋いでもＬＥＤが点かないことがときどきある。暴走してるのか？

<!-- dummy comment line for breaking list -->


||富士通ＦＲマイコンの諸元||
|ＦＬＡＳＨ ＲＯＭ|５１２ｋＢ||
|ＲＡＭ|１６ｋＢ||
|内部レジスタ|３２ビット×１６本|R13=ACC,R14=FP,R15=SP|
|ｃａｃｈｅ|１ｋＢ|？|
|ＣＰＵクロック|４０ＭＨｚ|水晶は１０ＭＨｚ４逓倍動作|
|ＶＧＡのＯＳＤ用のＣＧＲＯＭ|５１２ｋＢ|おそらく漢字フォントを入れるものらしい|
|ＵＳＢ|ホスト＋デバイス|ＩＦ基板ではｆｌａｓｈ書き込み用にＣＰ２１０２が付いているので都合３コネクタ|
|ＵＡＲＴ|５ｃｈ|なんでそんなにいるの？|
|外部バス接続|8,16,32bit幅、ROM,FLASH,SRAMなど。最大４Ｇまで。チップセレクト生成可能|残念だがこの石には外部バスは出ていない。かわりに内部でＯＳＤとの接続に外部バスが使われている。（じゃあ内部バスなの？）|

- アーキテクチャ的にはＲＩＳＣ。
- メモリー空間４Ｇ。
- ビッグエンディアン。
- ４０ＭＨｚ動作。１命令は１クロック実行。
- ＣＧＲＡＭは24x32dotが１７９２文字分あるらしい。

<!-- dummy comment line for breaking list -->

これの使い道ってどうよ？
- デジタル家電、PC周辺、および車載って、書いてあるけど。
- 実のところ、ＯＳＤ専用チップなのかも。
- ＵＳＢの使い道がよう分からん。液晶モニタにＵＳＢって、汎用ハブでいいんじゃぁ？
- ＣＰＵはたしかに高性能だが、この石はＯＳＤに割くリソースがでかいので、ＯＳＤ用に使わないなら、無駄が多いチップだといえる。
- ＯＳＤ抜きで考えると、まあカーナビの心臓部とか家電制御で割りと演算が速い必要があるやつ（そんなのあったっけ？）ＵＳＢは付いてるけどプリンタに使うには性能不足だし（ああ、スキャナーか。使うとしたら）デジカメっていうのも書いてあったけど・・・。

<!-- dummy comment line for breaking list -->

- - - -

#### なんかＨ８の２０ＭＨｚと比べると、性能は断然良さそう。
- これが１９８０円で買えるとはね。使うの大変そうだけど。
- ＰＩＣ１８Ｆ２５５０よりも断然良いよね。
- Ｈ８/３６９４Ｆがゴミに見えてきた。

<!-- dummy comment line for breaking list -->

#### ＤＷＭ２００８.５付録基板はどうなんだ？
- ＳＴＭ３２（ＡＲＭ Cortex-M3）が付くらしい。[http://www.cqpub.co.jp/dwm/advertise/0125arm.pdf](http://www.cqpub.co.jp/dwm/advertise/0125arm.pdf) 
- クロックは７２ＭＨｚくらい？メモリーはFlash128k+RAM20kB [http://www.tomen-ele.co.jp/ten/ten129/STM.pdf](http://www.tomen-ele.co.jp/ten/ten129/STM.pdf) 

<!-- dummy comment line for breaking list -->

富士通ＲＩＳＣと比べてどうなんだろう？
- フリーな開発環境（ｇｃｃ）が存在しないＦＲのほうが不利。
- ＵＳＢホストが欲しい->ＦＲ
- あとあと、いろいろな事例で活用したい->ＳＴＭ３２　Ｐｒｉｍｅｒとかが安価（３８００円くらい？）で入手できるしOlimexとか苺でも買えるので、ＡＲＭにしといたほうがよい。
    - というかＦＲの利点はＯＳＤとＵＳＢホストの２点だけ？
    - ＦＲは、外部にメモリー増設出来るのでこれも利点。

<!-- dummy comment line for breaking list -->

- 対するＳＴＭ３２のほうは、加速度センサが付いている。

<!-- dummy comment line for breaking list -->

順当に考えると、あとあとの入手性の高さでは圧倒的にＡＲＭ（ＳＴＭ３２）が有利。~
開発環境とかもね。~
ＦＲで何か作ろうとしても、付録基板しかないんじゃあ、ね。（個人でＦＲマイコンを発注したり入手するのはまず不可能なので）

- デバッガは３種類ある
    - シミュレータ、エミュレータ（２種類）、モニタデバッガ
    - 付録基板で出来るのはモニタデバッガのみ。
    - どうやらアプリケーションのリンク時にモニタデバッガのrelファイルを一緒にリンクすることでＳＯＦＴＵＮＥデバッガを使用可能とするものらしい。
    - skeltonのmain.cにて、
    
    		#define USE_MODFR60
    - という定義がされている。
    - これを有効にしておく（コメントアウトしないでおく）と、モニタデバッガに制御が移る。
    - テクニックとしては、main.cの初期化時に、
    
    		#ifdef USE_MODFR60
    		   mod_uart_init() ;           /* ホスト通信用UART(USBに変換される)初期化      */
    		   mod_timer_init() ;          /* 計測タイマ初期化                             */
    		#endif
    - とやって、

<!-- dummy comment line for breaking list -->

	#ifdef USE_MODFR60
	    __asm( " int #10" ) ;       /* モニタデバッガ起動                           */
	#endif
	   user_main() ;               /* ここに目的の処理を記述する。                 */
    - でuser_main()に行く直前にモニタに制御を移すわけだ。
- デバッグ時とそうでない実行時では、

		#define USE_MODFR60
- を書き換えてコンパイルし直さないといけないらしい。

<!-- dummy comment line for breaking list -->

- デバッガの仕組みとしてはチープだが、付録基板（あるいは試作基板）だけで

<!-- dummy comment line for breaking list -->
デバッガが使えるのでよし。
- gdbスタブみたいなもん。

<!-- dummy comment line for breaking list -->



- とりあえず何かを焼いてみる。

<!-- dummy comment line for breaking list -->

ＦＭ音源を焼いてみた。最初は焼き方が分からなかった。
    - Softuneではなく、FUJITSU flash MCU Programmerのほうを起動して、full operationを実行する。
    - このとき、JP3をCLOSEしておいて、さらに焼き開始後にJP4(RESET)を手動でCLOSE,OPENし、「ＯＫボタン」を押さなければならない---面倒だが。

<!-- dummy comment line for breaking list -->

ついでにＯＳＤサンプルも焼いてみた。
- ＶＧＡに出力出来た。
- スプライトみたいなやつが動いているがこれは１つしか出せない？？いわゆるカーソルのことか。

<!-- dummy comment line for breaking list -->

ＯＳＤは、機能的に微妙だ。
- いわゆるテキストＶＲＡＭは４２桁×１６行分しか用意されていない。
    - 例えば、ＭＺ８０Ｋエミュレータを書きたい、と思ったとしよう。
    - フォントは１７００種も用意できるが、行数が２５行用意できない。
    - 例えば、オシロスコープのようなアプリを書きたいとしても、
    - 任意の位置にドットを打つといったようなことは出来ない。
    - キャラジェネでパターンを工夫したとしても無理臭い・・・。
    - 例えば、ＶＴ１００みたいなものを作ろうと思ったとしよう。
    - ４２×１６文字で我慢するとしよう。ＡＮＫまでなら作成可能だ。
    - 漢字Ｔｅｒｍｉｎａｌにするには１７００文字だと第一水準ＪＩＳが全部入らない。帯に短し！
- 残念だが、ＶＤＰ機能はファミコンにも劣る。（その代わり、文字の解像度は細かい(24x32)が）

<!-- dummy comment line for breaking list -->

- Flashの書き換え回数の保証値

<!-- dummy comment line for breaking list -->
|Ｈ８／３６９４Ｆ| MIN 1000回 typ 10000回 |
|ＦＲ６０| １万回保証 。要望に応じて１０万回保証も可能らしい|


- - - -
## ＦＲマイコン・リンク集
- 早速アプリを公開しているサイト。

<!-- dummy comment line for breaking list -->

Joy Of MIDI FM tone generator
- [http://www.geocities.jp/pcm1723/](http://www.geocities.jp/pcm1723/) 
- ２オペレータのFM音源をエミュレート。入力はシリアルMIDI（38400bps）。デモ曲あり。

