[2008-05](2008-05.md) 

- - - -
## Ｈ８/３０４８Ｆ用のモニタ

[こちらから](Ｈ８／ｇｄｂｓｔｕｂ.md) ダウンロードしてください。（ページの最後尾にＤＯＷＮＬＯＡＤがあります）

特徴（といってもたいしたものはない）
- コードサイズは約６ｋＢ。
- スタートアップと割り込みとＪＭＰテーブル（０ｘ１００〜に置いてます）

<!-- dummy comment line for breaking list -->
以外は普通にＣ言語で書いてあるのでメンテが容易。
- ソースからのコンパイルは h8300-elf-gcc のようなクロスコンパイラを使用します。
    - コンパイラの入手は KPIT Gnu toolsとかGCC Developer LiteでＯＫ。
    - ＨＥＷには対応していません（すみません）移植は可能だと思いますが、ＨＥＷ自体が有料なので・・・。
- 秋月のベース基板のＤｉｐＳｗ７番がＯｎのときはベース基板上のＬＣＤの表示テストが走るようにしています。
- シリアル(SCI1)は１９２００ｂｐｓで接続するようにしています。（ボーレート変更コマンドあり）

<!-- dummy comment line for breaking list -->

- - - -
## で、ＯｐｅｎＣＶはどうなった？
- ソースを査読中
- ＤｉｒｅｃｔＸは使ってない。というか、メモリー上のＤＩＢビットマップをbitbltしている以外にＧＵＩなんてないじゃん。
- つまり、メモリー上のＤＩＢビットマップを単なるフレームバッファとみなしてＣＰＵ側で殴り書きするだけ？。
- これをＧＵＩと呼ぶのかどうか・・・。
- べつに画像処理をやるわけじゃないので、ＯｐｅｎＣＶじゃなくてもいいか・・・。~

<!-- dummy comment line for breaking list -->
思案中

- まあ、ＷｉｎとＬｉｎｕｘの両方に共通な簡易Ｃ言語というところは気に入った。
    - アプリ側の記述はＣで良い。Ｃ＋＋である必要さえない。
    - アプリ側については、昔ＢＡＳＩＣで書いていたような気軽さで書ける。
    - ＣｈというＣ言語インタープリタをサポートしたオプションもあるみたいだ。
    - ＣＩＮＴじゃだめなのか？Ｃｈってフリー（無料）なの？

<!-- dummy comment line for breaking list -->

## Atom 230とCeleron、Core 2、Athlon X2を比較
[http://pc.nikkeibp.co.jp/article/news/20080605/1004341/](http://pc.nikkeibp.co.jp/article/news/20080605/1004341/) 
- （システム全体の消費電力グラフを見てくれ！）
- 結論：
    - Ａｔｏｍの１.６Ｇは同クロックＣｏｒｅ２の半分の性能しかない。（シングルコアでの比較）
    - それでもＶＩＡ　Ｃ７をぶっちぎり（２倍以上速い）
    - 消費電力的には現在地球上（Ｘ８６に限定）最速で地球に優しい。
        - むしろチップセットのほうが食ってないか？
    - ＡＭＤの駄目っぷりも手に取るように分かる。
        - ＡＭＤ系システムを選ぶメリットがまるでない。ＡＴＩグラフィックス？いや、それはビデオカードを買えば良いわけで・・・。

<!-- dummy comment line for breaking list -->

## Ｉｎｔｅｌにとって望ましくないシナリオ
この図は分かりやすい。
- [http://pc.watch.impress.co.jp/docs/2008/0616/kaigai445.htm](http://pc.watch.impress.co.jp/docs/2008/0616/kaigai445.htm) 

<!-- dummy comment line for breaking list -->

望ましくない＝
- ＰＣ（メインストリーム）をＡｔｏｍが食ってしまう。

<!-- dummy comment line for breaking list -->

望ましい＝
- Ｅｍｂｅｄｄｅｄ（組み込み市場＝＝**ずばりＡＲＭのことだ**）をＡｔｏｍが置き換える。

<!-- dummy comment line for breaking list -->

- そのために（量産能力は充分にあるが）供給を絞っているという。

<!-- dummy comment line for breaking list -->

- しかし、はっきりいって、今の（そして将来の統合チップでの）Ｓｉｌｖｅｒｔｈｏｎｅ＋ＳＣＨ（ＰｏｗｅｒＶＲコア）は、ｎＶｉｄｉａ　ＴＥＧＲＡに対してすら競争力が無い。
    - （のに、さらにローパワーを要求される携帯電話系に採用するわけ無いじゃん）
- だから、ＡＲＭ市場を攻めるのは無理だ。

<!-- dummy comment line for breaking list -->
~
- Ａｔｏｍのメーンターゲットは SIZE(28){ＷｉｎｄｏｗｓＸＰの軽量クライアント市場限定}だ

<!-- dummy comment line for breaking list -->

~
- intelだって、ほんとうはＡＲＭと戦って勝てないことくらい分かってやってるんだ。
- 少なくとも現状ではね。
- あと２世代くらい先でトータルコストとトータル消費電力でＡＲＭと勝負出来るようになったら、また戦況は変わるだろう。
- 元々intelはＰｅｎｔｉｕｍとかＣｏｒｅ２みたいに単一アーキテクチャーを、超大量生産するマニュファクチャーが得意。
    - それだと、上下方向に広がりを持てないのでＡＭＤからの隙間攻撃に弱い。
    - だから、キャッシュ容量やＦＳＢやイネーブルするＣｏｒｅの数を制限した**だけ**の同一チップを、いろいろな価格をつけて売るという商売をやっている。
- それに対し、ＡＲＭはＩＰコア（知的財産）で商売をやっている。
    - intelがＡＲＭのようにＡｔｏｍコアのライセンスを携帯各社やゲーム機屋（任天堂など）に販売する、なんてことは絶対にありえない。
    - ＡｔｏｍやＣｏｒｅ２などは、intel以外の会社が生産できるような簡単なチップじゃないし、他社が生産出来たとしても、intelほどの量産効果が出ないので結果的に高コストになる。

<!-- dummy comment line for breaking list -->



~
- - - -
### ATMega88を使ってみた。
**ドジ日記**
- 今回のＭｅｇａ８８チップは、秋月で＠２５０円で購入したもの。
- Ｍｅｇａ８８を使うのは初めてなので、今回趣向を変えて水晶をソケットにしてみた。
- ＬＥＤ　Ｇａｍｅを改造されている人のＨＰからＤＬしたＨＥＸを焼いていろいろ試す。
- ＮＩＣＯのＬＥＤ　Ｇａｍｅって、Ｍｅｇａ１６８じゃん。８ｋ以上が入らないよー。
- とりあえず音だけは鳴らしてみた。
    - ところが、テンポ遅いしトーン低いし、ＰＣＭノイズ出まくり。
- 水晶を２５ＭＨｚにしてもまだまだだめだ。（でも動いている）
- 結局、ＦｕｓｅビットのＬｏｗのＭＳＢが０（デフォルトのまま）であることに気づいた。
- これが０だとシステムクロック８分周が選択される。

<!-- dummy comment line for breaking list -->

てっきり、１のときに８分周だとばかり思い込んでいたらしい。

- １にしたらやたらテンポが速くなった。
- 内蔵ＲＣの８ＭＨｚで、８分周をＯＦＦにすると、正しく演奏してくれたようだ。

<!-- dummy comment line for breaking list -->

- - - -
## GINGER
これは、ＡＴＭｅｇａ８８（とＡＶＲ-ＵＳＢ）で構成されたＧＡＩＮＥＲ互換デバイスだ
- [http://web.mac.com/kuwatay/morecat_lab./ginger.html](http://web.mac.com/kuwatay/morecat_lab./ginger.html) 
- [http://kanta.but.jp/wordpress/?p=294](http://kanta.but.jp/wordpress/?p=294) 

<!-- dummy comment line for breaking list -->

- 久しぶりにAVR-USBのサイトを見に行ったら、ＡＶＲ-ＵＳＢが新しくなっていた。
- クロック２０ＭＨｚ版のＵＳＢドライバーが追加されている。
- GINGERについてもAVR-USBの本家からリンクされている。

<!-- dummy comment line for breaking list -->

- せっかくATMega88の汎用ボードを作っていたので、実験してみた。
    - 水晶はどこぞのソケット７マザボから引き抜いた２０ＭＨｚ（たぶん１０ＢａｓｅＴ用かと）。
    - gingerソースを入手。
    - AVRUSB本家の最新ドライバーを入手。~

<!-- dummy comment line for breaking list -->
usbconfig.hに１行追加
	#define USB_CFG_CLOCK_KHZ  20000
    - Windowsに繋いでみる。ＵＳＢ認識したらgainer.infを食わせる。
    - 仮想ＣＯＭポートが見えたので、teratermを起動して、適当なgainerコマンドを手入力。
    - 連続入力モードにすると、ＨＥＸでポートのビットなどが流れてくる。

<!-- dummy comment line for breaking list -->

全てＯＫだ。
- ただし、USBのＤ−をPORT D-bit3 に繋いでしまった（usbconfig.hも書き換えた）ので

<!-- dummy comment line for breaking list -->
KONFIGURATIONでUSBのＤ−が出力設定になるようなconfigを行うとＵＳＢ側が死ぬ・・・

- やっぱり配線図はそのままで再現させるべきだった・・・
- gingerをATMega88テスト基板＋ＵＳＢ接続の動作テストに使わせてもらった格好だ。

<!-- dummy comment line for breaking list -->

- ＲＯＭの使用率は、こんな感じ。

		AVR Memory Usage
		----------------
		Device: atmega88
		Program:    7136 bytes (87.1% Full)
		(.text + .data + .bootloader)
		#
		Data:        777 bytes (75.9% Full)
		(.data + .bss + .noinit)
- Mega88では少しだけ余裕。（残り１ｋＢ？）
- 見た感じ**ＰＳｏＣ版のソースよりずっと良い感じだ**

<!-- dummy comment line for breaking list -->


- - - -
## AVRUSBがやや不調
- 現在、ＳｉＳマザーに接続されたginger（仮想ＣＯＭポート）が不調だ。
- 何故だか分からない・・・。

<!-- dummy comment line for breaking list -->

症状
- ＵＳＢデバイスとしての認識はＯＫ。
- 仮想ＣＯＭポートとしても認識ＯＫ。
- 但しteratermから見ると、全くエコーバックしない。

<!-- dummy comment line for breaking list -->

場合分け
|Case|パソコンのポート|中継ＨＵＢ|動作状況|
|（１）|ＵＳＢ2.0ポート|直結|問題なし|
|（２）|ＵＳＢ2.0ポート|USB2.0ハブ経由|動作不良（症状は上記）|
|（３）|ＵＳＢ2.0ポート|USB1.1ハブ経由|問題なし|
|（４）|ＵＳＢ2.0ポート|USB1.1ハブを経由後、USB2.0ハブを通してAVRUSB|問題なし|

- 最初は（１）も駄目だった。
    - これは、自分がCOM bridgeドライバーがCOM5とCOM9を連結していて、そこに割り当てられてしまうと駄目になる問題だった。
    - COMポート5,9を避けることで回避した。

<!-- dummy comment line for breaking list -->

- USB1.1ハブは２つ試した。
- USB2.0ハブは１つしか持っていない。（安物）

<!-- dummy comment line for breaking list -->

推測するに、ＵＳＢ２.０ハブ経由でのバルク転送問題かと・・・。
- しかし２連結のときはうまくいくので不思議だ。
- もしかしたら、手持ちのハブだけの問題かもしれない（ＬｏｗＳｐｅｅｄのバルク転送が通らない問題）

<!-- dummy comment line for breaking list -->

ＷｉｎＶｉｓｔａで試そうとしたら、Ｖｉｓｔａが起動しなくなっていた。
- ３０日問題ではなくて、使わないから消してしまっていたらしい・・・

<!-- dummy comment line for breaking list -->




- - - -

## そろそろＡＶＲ-ＵＳＢを卒業して、AT90USBに手を出そうかとも思っている。
- [http://www.microfan.jp/shop/index.html](http://www.microfan.jp/shop/index.html) 
- マイクロファンのネットショップにて２１００円だし。
- 以前に比べると、面白そうなキットが増えている。（面白そうというベクトルが昔は別の方向を向いていて、ある意味面白かったのだが、今回は真面目な意味だ）
- 秋月のＦＴ２３２ボードも買ったまま放置してるのにこのていたらくと言われると弱いんだが。

